<!DOCTYPE html 2 in 1>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>YT Home ‚Äì Cho thu√™ ph√≤ng tr·ªç & cƒÉn h·ªô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="yt-home-api" content="https://script.google.com/macros/s/AKfycbzoK0qFRv1cPfrglrp9NThC-YLXAx26ashfM7T3LnsPjKRY52HN3eMak_IhE9W8j7Uehg/exec" />

  <!-- CSS d√πng chung (ƒë√£ chuy·ªÉn to√†n b·ªô <style> v√†o ƒë√¢y) -->
  <link rel="stylesheet" href="yt-home-common.css" />
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container">
      <div class="nav">
        <div class="logo">
          <div class="logo-icon">YT</div>
          <div>
            <div>YT Home</div>
            <div class="logo-sub">Kh√¥ng gian s·ªëng an to√†n & ti·ªán nghi</div>
          </div>
        </div>

        <nav class="nav-links">
          <a href="#rooms">Ph√≤ng tr·ªç & CƒÉn h·ªô</a>
          <a href="#features">Ti·ªán √≠ch</a>
          <a href="#process">Quy tr√¨nh thu√™</a>
          <a href="#contact">Li√™n h·ªá</a>
        </nav>

        <div class="nav-cta">
          <!-- N√∫t t√†i kho·∫£n ph√≤ng: t·ª± ki·ªÉm tra ƒë√£ login ch∆∞a -->
          <button class="btn-outline btn" type="button" onclick="openTenantPortal()">
            T√†i kho·∫£n ph√≤ng
          </button>
          <button class="btn-outline btn" type="button" onclick="scrollToSection('contact')">
            G·ªçi t∆∞ v·∫•n
          </button>
          <button class="btn" type="button" onclick="scrollToSection('rooms')">
            Xem ph√≤ng
          </button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container">
        <div class="hero-grid">
          <div>
            <div class="badge">
              <span class="badge-dot"></span>
              <span>YT Home ‚Äì 34 ph√≤ng tr·ªç & cƒÉn h·ªô</span>
            </div>
            <h1 class="hero-title">
              Thu√™ ph√≤ng d·ªÖ d√†ng t·∫°i
              <span class="hero-highlight">YT Home</span>
            </h1>
            <p class="hero-subtitle">
              H·ªá th·ªëng ph√≤ng tr·ªç v√† cƒÉn h·ªô mini ƒë·∫ßy ƒë·ªß n·ªôi th·∫•t, an ninh, gi·ªù gi·∫•c linh ho·∫°t,
              ph√π h·ª£p sinh vi√™n, nh√¢n vi√™n vƒÉn ph√≤ng v√† gia ƒë√¨nh tr·∫ª.
            </p>

            <div class="hero-cta">
              <button class="btn" onclick="scrollToSection('rooms')">Xem danh s√°ch ph√≤ng</button>
              <button class="btn-outline btn" onclick="scrollToSection('contact')">
                ƒê·∫∑t l·ªãch xem ph√≤ng
              </button>
            </div>

            <p class="hero-note">
              <strong>Cam k·∫øt:</strong> H·ª£p ƒë·ªìng r√µ r√†ng ‚Äì Kh√¥ng thu ph√≠ m√¥i gi·ªõi ‚Äì H·ªó tr·ª£ online 24/7.
            </p>

            <div class="hero-stats">
              <div class="stat-card">
                <div class="stat-value" id="statTotalRooms">--</div>
                <div class="stat-label">Ph√≤ng & cƒÉn h·ªô</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">3</div>
                <div class="stat-label">Lo·∫°i ph√≤ng (ƒë∆°n, ƒë√¥i, cƒÉn h·ªô)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statAvailable">--</div>
                <div class="stat-label">Ph√≤ng c√≤n tr·ªëng</div>
              </div>
            </div>
          </div>

          <div>
            <div class="hero-card">
              <div class="hero-card-header">
                <div class="hero-card-title">T·ªïng quan t√≤a nh√† YT Home</div>
                <div class="hero-pill" id="heroStatus">ƒêang t·∫£i...</div>
              </div>

              <!-- BI·ªÇU ƒê·ªí T·ªîNG QUAN -->
              <div class="hero-chart" id="heroOverview"></div>

              <div class="hero-card-footer">
                <div class="hero-badge-row">
                  <div class="hero-badge">Thang m√°y & g·ª≠i xe</div>
                  <div class="hero-badge">Camera an ninh 24/7</div>
                  <div class="hero-badge">Wifi t·ªëc ƒë·ªô cao</div>
                </div>
                <div>Gi√° t·ª´ <strong>2.8 ‚Äì 6 tri·ªáu/th√°ng</strong> (tham kh·∫£o)</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ROOMS LIST -->
    <section id="rooms">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Danh s√°ch ph√≤ng tr·ªç & cƒÉn h·ªô</div>
            <p class="section-subtitle">
              Ph√≤ng ƒë∆∞·ª£c s·∫Øp x·∫øp theo t·∫ßng (tr·ªát, t·∫ßng 1, 2, 3, 4, 5). B·∫°n c√≥ th·ªÉ l·ªçc theo lo·∫°i,
              t√¨nh tr·∫°ng, t·∫ßng, gi√°, di·ªán t√≠ch, ƒë√°nh gi√° v√† m·ª©c ƒë·ªô quan t√¢m.
            </p>
          </div>
        </div>

        <!-- L·ªçc theo lo·∫°i ph√≤ng & t√¨nh tr·∫°ng -->
        <div class="filter-bar">
          <button class="filter-pill active" data-filter="all">T·∫•t c·∫£</button>
          <button class="filter-pill" data-filter="Ph√≤ng ƒë∆°n">Ph√≤ng ƒë∆°n</button>
          <button class="filter-pill" data-filter="Ph√≤ng ƒë√¥i">Ph√≤ng ƒë√¥i</button>
          <button class="filter-pill" data-filter="CƒÉn h·ªô mini">CƒÉn h·ªô mini</button>
          <button class="filter-pill" data-filter="available">C√≤n tr·ªëng</button>
        </div>

        <!-- B·ªô l·ªçc n√¢ng cao -->
        <div class="filter-advanced">
          <select id="filterFloor" class="filter-select">
            <option value="all">T·∫•t c·∫£ t·∫ßng</option>
            <option value="0">Tr·ªát</option>
            <option value="1">T·∫ßng 1</option>
            <option value="2">T·∫ßng 2</option>
            <option value="3">T·∫ßng 3</option>
            <option value="4">T·∫ßng 4</option>
            <option value="5">T·∫ßng 5</option>
          </select>

          <select id="filterRating" class="filter-select">
            <option value="all">T·∫•t c·∫£ ƒë√°nh gi√°</option>
            <option value="rated">Ch·ªâ ph√≤ng ƒë√£ c√≥ ƒë√°nh gi√°</option>
            <option value="3plus">T·ª´ 3‚òÖ tr·ªü l√™n</option>
            <option value="4plus">T·ª´ 4‚òÖ tr·ªü l√™n</option>
          </select>

          <select id="filterInterest" class="filter-select">
            <option value="all">Quan t√¢m (t·∫•t c·∫£)</option>
            <option value="liked">Ch·ªâ ph√≤ng ƒë√£ b·∫•m ‚ô•</option>
          </select>

          <select id="filterPrice" class="filter-select">
            <option value="all">Gi√° (t·∫•t c·∫£)</option>
            <option value="lt3">D∆∞·ªõi 3 tri·ªáu</option>
            <option value="3-35">3 ‚Äì 3.5 tri·ªáu</option>
            <option value="35-4">3.5 ‚Äì 4 tri·ªáu</option>
            <option value="gt4">Tr√™n 4 tri·ªáu</option>
          </select>

          <select id="filterArea" class="filter-select">
            <option value="all">Di·ªán t√≠ch (t·∫•t c·∫£)</option>
            <option value="lt18">D∆∞·ªõi 18 m¬≤</option>
            <option value="18-25">18 ‚Äì 25 m¬≤</option>
            <option value="gt25">Tr√™n 25 m¬≤</option>
          </select>
        </div>

        <div class="rooms-grid" id="roomsGrid"></div>
        <p id="roomsStatus"
           style="margin-top:8px; font-size:0.8rem; color:rgba(148,163,184,0.95);">
          ƒêang t·∫£i d·ªØ li·ªáu ph√≤ng...
        </p>
      </div>
    </section>

    <!-- FEATURES -->
    <section id="features">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Ti·ªán √≠ch t·∫°i YT Home</div>
            <p class="section-subtitle">
              T·∫≠p trung v√†o tr·∫£i nghi·ªám s·ªëng an to√†n, s·∫°ch s·∫Ω, ƒë·∫ßy ƒë·ªß ti·ªán nghi, h·ªó tr·ª£ t·ªëi ƒëa cho c∆∞ d√¢n.
            </p>
          </div>
        </div>

        <div class="feature-grid">
          <div class="card">
            <div class="card-icon">üè†</div>
            <div class="card-title">Ph√≤ng m·ªõi, ƒë·∫ßy ƒë·ªß n·ªôi th·∫•t</div>
            <p>Gi∆∞·ªùng, t·ªß, m√°y l·∫°nh, m√°y n∆∞·ªõc n√≥ng, b·∫øp (tu·ª≥ lo·∫°i ph√≤ng), ban c√¥ng tho√°ng m√°t.</p>
          </div>
          <div class="card">
            <div class="card-icon">üõ°Ô∏è</div>
            <div class="card-title">An ninh 24/7</div>
            <p>Camera to√†n khu, c·ª≠a kho√° t·ª´/ v√¢n tay, b√£i xe c√≥ m√°i che, qu·∫£n l√Ω h·ªó tr·ª£ khi c·∫ßn.</p>
          </div>
          <div class="card">
            <div class="card-icon">üåê</div>
            <div class="card-title">K·∫øt n·ªëi & ti·ªán √≠ch xung quanh</div>
            <p>G·∫ßn ch·ª£, si√™u th·ªã, tr·∫°m xe bu√Ωt, b·ªánh vi·ªán, tr∆∞·ªùng h·ªçc; ph√π h·ª£p ng∆∞·ªùi ƒëi l√†m & sinh vi√™n.</p>
          </div>
          <div class="card">
            <div class="card-icon">üßæ</div>
            <div class="card-title">Chi ph√≠ r√µ r√†ng</div>
            <p>ƒêi·ªán, n∆∞·ªõc, wifi, ph√≠ gi·ªØ xe minh b·∫°ch; h·ª£p ƒë·ªìng r√µ r√†ng; kh√¥ng thu th√™m ph√≠ m√¥i gi·ªõi.</p>
          </div>
          <div class="card">
            <div class="card-icon">üßπ</div>
            <div class="card-title">Kh√¥ng gian s·∫°ch & xanh</div>
            <p>Khu v·ª±c chung ƒë∆∞·ª£c v·ªá sinh ƒë·ªãnh k·ª≥; khuy·∫øn kh√≠ch ph√¢n lo·∫°i r√°c, s·ªëng xanh.</p>
          </div>
          <div class="card">
            <div class="card-icon">ü§ù</div>
            <div class="card-title">Ch·ªß nh√† th√¢n thi·ªán</div>
            <p>
              H·ªó tr·ª£ th·ªß t·ª•c c∆∞ tr√∫, chia s·∫ª th√¥ng tin khu v·ª±c; ∆∞u ti√™n c∆∞ d√¢n ·ªü l√¢u d√†i, vƒÉn minh.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PROCESS -->
    <section id="process">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Quy tr√¨nh thu√™ ph√≤ng t·∫°i YT Home</div>
            <p class="section-subtitle">
              Ch·ªâ v·ªõi 4 b∆∞·ªõc ƒë∆°n gi·∫£n, b·∫°n ƒë√£ c√≥ th·ªÉ d·ªçn v√†o cƒÉn ph√≤ng m·ªõi c·ªßa m√¨nh.
            </p>
          </div>
        </div>

        <div class="process-grid">
          <div class="card">
            <div class="card-icon">üîç</div>
            <div class="card-title">B∆∞·ªõc 1 ‚Äì Ch·ªçn ph√≤ng</div>
            <ul>
              <li>Xem danh s√°ch ph√≤ng c√≤n tr·ªëng tr√™n website.</li>
              <li>L·ªçc theo lo·∫°i ph√≤ng, di·ªán t√≠ch, gi√°.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">üìÖ</div>
            <div class="card-title">B∆∞·ªõc 2 ‚Äì ƒê·∫∑t l·ªãch xem</div>
            <ul>
              <li>Li√™n h·ªá qua ƒëi·ªán tho·∫°i/ Zalo/ form d∆∞·ªõi.</li>
              <li>Ch·ªçn gi·ªù xem ph√≤ng ph√π h·ª£p.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">üè°</div>
            <div class="card-title">B∆∞·ªõc 3 ‚Äì Xem & ch·ªët ph√≤ng</div>
            <ul>
              <li>Tham quan th·ª±c t·∫ø ph√≤ng & khu v·ª±c chung.</li>
              <li>Th·ªëng nh·∫•t gi√°, c·ªçc, th·ªùi gian ·ªü.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">‚úçÔ∏è</div>
            <div class="card-title">B∆∞·ªõc 4 ‚Äì K√Ω h·ª£p ƒë·ªìng</div>
            <ul>
              <li>K√Ω h·ª£p ƒë·ªìng thu√™ r√µ r√†ng, minh b·∫°ch.</li>
              <li>Nh·∫≠n ch√¨a kh√≥a, d·ªçn v√†o ·ªü.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">üì≤</div>
            <div class="card-title">H·ªó tr·ª£ trong su·ªët th·ªùi gian ·ªü</div>
            <ul>
              <li>Li√™n h·ªá ch·ªß nh√† khi c·∫ßn s·ª≠a ch·ªØa, h·ªó tr·ª£.</li>
              <li>Gia h·∫°n h·ª£p ƒë·ªìng linh ho·∫°t.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Li√™n h·ªá YT Home</div>
            <p class="section-subtitle">
              ƒêi·ªÅn th√¥ng tin b√™n d∆∞·ªõi ho·∫∑c nh·∫Øn tr·ª±c ti·∫øp qua Zalo/ƒêi·ªán tho·∫°i ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n nhanh nh·∫•t.
            </p>
          </div>
        </div>

        <div class="contact-grid">
          <div class="contact-info">
            <p class="contact-highlight">S·∫µn s√†ng h·ªó tr·ª£ b·∫°n t√¨m ph√≤ng ph√π h·ª£p üí¨</p>
            <p><strong>ƒê·ªãa ch·ªâ:</strong> Ph∆∞·ªùng T√¢n B√¨nh, Tp. HCM</p>
            <p><strong>ƒêi·ªán tho·∫°i/Zalo:</strong> <span id="contactPhoneText">YT Home</span></p>
            <p><strong>Email:</strong> <span id="contactEmailText">sale@thuephongtanbinh.com</span></p>
            <p style="margin-top: 8px;">
              B·∫°n c√≥ th·ªÉ ghi r√µ lo·∫°i ph√≤ng mong mu·ªën (ƒë∆°n, ƒë√¥i, cƒÉn h·ªô), kho·∫£ng gi√° 
              v√† th·ªùi gian d·ªçn v√†o. Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi trong th·ªùi gian s·ªõm nh·∫•t.
            </p>
          </div>

          <form class="contact-form" id="contactForm">
            <div class="form-group">
              <label for="name">H·ªç v√† t√™n</label>
              <input id="name" class="form-control" type="text" required />
            </div>
            <div class="form-group">
              <label for="phone">S·ªë ƒëi·ªán tho·∫°i/Zalo</label>
              <input id="phone" class="form-control" type="tel" required />
            </div>
            <div class="form-group">
              <label for="roomType">Lo·∫°i ph√≤ng quan t√¢m</label>
              <select id="roomType" class="form-control">
                <option value="">-- Ch·ªçn lo·∫°i ph√≤ng --</option>
                <option>Ph√≤ng ƒë∆°n</option>
                <option>Ph√≤ng ƒë√¥i</option>
                <option>CƒÉn h·ªô mini</option>
                <option>Ch∆∞a x√°c ƒë·ªãnh, c·∫ßn t∆∞ v·∫•n</option>
              </select>
            </div>
            <div class="form-group">
              <label for="message">N·ªôi dung</label>
              <textarea id="message" class="form-control"
                        placeholder="V√≠ d·ª•: C·∫ßn ph√≤ng ƒë∆°n, gi√° kho·∫£ng 3‚Äì3.5 tri·ªáu, d·ªçn v√†o ƒë·∫ßu th√°ng t·ªõi..."></textarea>
            </div>
            <button type="submit" class="btn" style="width: 100%; justify-content: center;">
              G·ª≠i y√™u c·∫ßu t∆∞ v·∫•n
            </button>
            <p id="formStatus"
               style="margin-top: 6px; font-size: 0.8rem; color: rgba(148,163,184,0.96);"></p>

            <div style="margin-top:10px; font-size:0.8rem; color:rgba(148,163,184,0.96);">
              Ho·∫∑c li√™n h·ªá nhanh:
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
              <a id="zaloQuickLink" class="btn-outline btn"
                 href="#"
                 target="_blank" rel="noopener noreferrer"
                 style="padding:6px 14px; font-size:0.78rem;">
                Nh·∫Øn Zalo
              </a>

              <a id="emailQuickLink" class="btn-outline btn"
                 href="#"
                 style="padding:6px 14px; font-size:0.78rem;">
                G·ª≠i Email
              </a>

              <a id="messengerQuickLink" class="btn-outline btn"
                 href="#"
                 target="_blank" rel="noopener noreferrer"
                 style="padding:6px 14px; font-size:0.78rem;">
                Chat Messenger
              </a>
            </div>
          </form>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-row">
        <div>¬© <span id="year"></span> YT Home.</div>
        <div>C√≥ th·ªÉ m·ªü r·ªông th√™m: ƒëƒÉng nh·∫≠p, qu·∫£n l√Ω h·ª£p ƒë·ªìng, b√°o c√°o thu ‚Äì chi.</div>
      </div>
    </div>
  </footer>

  <!-- MODAL VIDEO -->
  <div id="videoModal" class="video-modal">
    <div class="video-modal-backdrop" onclick="closeVideoModal()"></div>
    <div class="video-modal-content">
      <button type="button" class="video-modal-close" onclick="closeVideoModal()">‚úï</button>
      <div id="videoContainer"></div>
    </div>
  </div>

  <!-- JS d√πng chung (t·∫•t c·∫£ code trong <script> c≈© ƒë√£ chuy·ªÉn sang file n√†y) -->
  <script src="yt-home-common.js"></script>
<script src="yt-home-common.js"></script>
<script>
/* ======================================================
 * YT Home ‚Äì Public index: l·∫•y data t·ª´ roominfo (JSONP)
 * - ƒê·ªçc API_URL t·ª´ meta[name="yt-home-api"]
 * - N·∫øu URL c√≥ ?room=P205 -> g·ªçi action=roominfo&roomCode=P205
 * ====================================================== */
(function () {
  const PORTAL_PAGE = "portal.html";

  // ‚úÖ l·∫•y API_URL t·ª´ meta
  const API_URL = (document.querySelector('meta[name="yt-home-api"]')?.content || "").trim();

  // ‚úÖ JSONP call (kh√¥ng c·∫ßn SID cho roominfo)
  function callApiPublic(action, params = {}) {
    return new Promise((resolve, reject) => {
      if (!API_URL) return reject(new Error("Missing API_URL (meta[name=yt-home-api])"));

      const cb = "cb_" + Date.now() + "_" + Math.floor(Math.random() * 1000);
      const ts = Date.now();
      const merged = { ...params, ts };

      let s = null;
      let done = false;

      const timeoutMs = 15000;
      const timer = setTimeout(() => {
        if (done) return;
        done = true;
        cleanup();
        reject(new Error("JSONP timeout (" + timeoutMs + "ms)"));
      }, timeoutMs);

      window[cb] = (data) => {
        if (done) return;
        done = true;
        clearTimeout(timer);
        cleanup();
        resolve(data);
      };

      const qs = new URLSearchParams({
        action: String(action || "").trim(), // roominfo
        ...merged,
        callback: cb
      }).toString();

      s = document.createElement("script");
      s.async = true;
      s.src = API_URL + (API_URL.includes("?") ? "&" : "?") + qs;

      s.onerror = () => {
        if (done) return;
        done = true;
        clearTimeout(timer);
        cleanup();
        reject(new Error("JSONP load failed"));
      };

      document.body.appendChild(s);

      function cleanup() {
        try { delete window[cb]; } catch (e) { window[cb] = undefined; }
        if (s && s.parentNode) s.parentNode.removeChild(s);
      }
    });
  }
function formatPrice_(v){
  if (v == null || v === '') return '';
  // n·∫øu l√† s·ªë: format VN
  const num = Number(String(v).toString().replace(/[^\d.]/g,''));
  if (Number.isFinite(num) && num > 0) {
    return num.toLocaleString('vi-VN') + ' ƒë/th√°ng';
  }
  return String(v);
}

function formatArea_(v){
  if (v == null || v === '') return '';
  const s = String(v).trim();
  if (/m2|m¬≤/i.test(s)) return s;
  // n·∫øu l√† s·ªë
  const num = Number(String(s).replace(',', '.'));
  if (Number.isFinite(num)) return num + ' m¬≤';
  return s;
}

function floorLabel_(floor){
  if (String(floor) === '0') return 'Tr·ªát';
  if (!floor) return 'Kh√°c';
  return 'T·∫ßng ' + floor;
}

function renderRoomsByFloor_(rooms){
  const grid = document.getElementById('roomsGrid');
  const status = document.getElementById('roomsStatus');
  if (!grid) return;

  if (!Array.isArray(rooms) || rooms.length === 0){
    grid.innerHTML = '';
    if (status) status.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu ph√≤ng.';
    return;
  }

  // group by floor
  const groups = new Map();
  rooms.forEach(r => {
    const f = String(r.floor ?? '').trim() || '';
    if (!groups.has(f)) groups.set(f, []);
    groups.get(f).push(r);
  });

  // sort floors
  const floors = Array.from(groups.keys()).sort((a,b)=>{
    const na = (a==='0')?0:parseInt(a||'999',10);
    const nb = (b==='0')?0:parseInt(b||'999',10);
    return (Number.isFinite(na)?na:999) - (Number.isFinite(nb)?nb:999);
  });

  let html = '';
  floors.forEach(f => {
    const list = groups.get(f) || [];
    html += `
      <div class="floor-block" style="grid-column: 1 / -1; margin-top: 14px;">
        <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:10px;">
          <div style="font-weight:700; font-size:1.05rem; color:rgba(226,232,240,0.95);">
            ${floorLabel_(f)}
          </div>
          <div style="font-size:0.82rem; color:rgba(148,163,184,0.95);">
            ${list.length} ph√≤ng
          </div>
        </div>
      </div>
    `;

    list.forEach(r => {
      const roomCode = r.roomCode || '';
      const available = !!r.available;
      const pill = available
        ? `<span class="hero-pill" style="background:rgba(34,197,94,0.16); color:#86efac;">C√≤n tr·ªëng</span>`
        : `<span class="hero-pill" style="background:rgba(248,113,113,0.14); color:#fecaca;">ƒêang thu√™</span>`;

      html += `
        <div class="card" style="padding:14px;">
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:10px;">
            <div>
              <div style="font-weight:800; font-size:1.02rem;">${roomCode}</div>
              <div style="margin-top:4px; font-size:0.82rem; color:rgba(148,163,184,0.95);">
                ${r.type ? r.type : (r.status || '')}
              </div>
            </div>
            ${pill}
          </div>

          <div style="margin-top:10px; display:grid; grid-template-columns:1fr; gap:6px; font-size:0.86rem;">
            ${r.price ? `<div>üí∞ <strong>${formatPrice_(r.price)}</strong></div>` : ``}
            ${r.area ? `<div>üìê ${formatArea_(r.area)}</div>` : ``}
          </div>

          <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
            <button class="btn" type="button"
              onclick="openTenantPortal('${String(roomCode).replace(/'/g, "\\'")}')"
              ${available ? '' : ''}>
              T√†i kho·∫£n ph√≤ng
            </button>
            <button class="btn-outline btn" type="button" onclick="scrollToSection('contact')">
              H·ªèi t∆∞ v·∫•n
            </button>
          </div>
        </div>
      `;
    });
  });

  grid.innerHTML = html;

  // stats
  const total = rooms.length;
  const avail = rooms.filter(r => r && r.available).length;
  const statTotalRooms = document.getElementById('statTotalRooms');
  const statAvailable = document.getElementById('statAvailable');
  if (statTotalRooms) statTotalRooms.textContent = String(total);
  if (statAvailable) statAvailable.textContent = String(avail);

  const heroStatus = document.getElementById('heroStatus');
  if (heroStatus) heroStatus.textContent = `C√≤n tr·ªëng: ${avail}/${total}`;

  if (status) status.textContent = `ƒê√£ t·∫£i ${total} ph√≤ng.`;
}

async function loadRoomsForIndex_(){
  const status = document.getElementById('roomsStatus');
  if (status) status.textContent = 'ƒêang t·∫£i d·ªØ li·ªáu ph√≤ng...';

  try {
    const res = await callApiPublic('rooms', {});
    console.log('ROOMS =', res);

    if (!res || res.ok !== true){
      if (status) status.textContent = res?.error || 'Kh√¥ng l·∫•y ƒë∆∞·ª£c danh s√°ch ph√≤ng.';
      return;
    }

    const rooms = res.data || [];
    renderRoomsByFloor_(rooms);

  } catch (err) {
    console.error(err);
    if (status) status.textContent = 'L·ªói k·∫øt n·ªëi t·ªõi Apps Script (rooms).';
  }
}

  // ‚úÖ Override openTenantPortal(): ƒëi·ªÅu h∆∞·ªõng portal.html?room=<M√£ ph√≤ng>
  window.openTenantPortal = function (roomCode) {
    const r = String(roomCode || "").trim();
    const url = r ? (PORTAL_PAGE + "?room=" + encodeURIComponent(r)) : PORTAL_PAGE;
    window.location.href = url;
  };

  // ‚úÖ N·∫øu index.html c√≥ ?room=... th√¨ g·ªçi roominfo ƒë·ªÉ l·∫•y data (demo)
  async function loadRoomInfoFromQuery() {
    const qs = new URLSearchParams(window.location.search);
    const room = String(qs.get("room") || "").trim();
    if (!room) return;

    // b·∫°n c√≥ th·ªÉ ƒë·ªïi ch·ªó hi·ªÉn th·ªã tu·ª≥ UI
    const heroStatus = document.getElementById("heroStatus");
    if (heroStatus) heroStatus.textContent = "ƒêang t·∫£i ph√≤ng " + room + "...";

    try {
      const res = await callApiPublic("roominfo", { roomCode: room });
      console.log("ROOMINFO =", res);

      if (res && res.ok === true && res.data) {
        if (heroStatus) heroStatus.textContent = "ƒê√£ t·∫£i: " + room;
        // V√≠ d·ª•: n·∫øu data c√≥ tr∆∞·ªùng "T√¨nh tr·∫°ng" / "Trang th√°i"
        // b·∫°n t·ª± map ƒë√∫ng header sheet c·ªßa b·∫°n
        // const st = res.data["Tr·∫°ng th√°i"] || res.data["T√¨nh tr·∫°ng"];
        // if (st && heroStatus) heroStatus.textContent = st;

      } else {
        if (heroStatus) heroStatus.textContent = res?.warning || res?.error || ("Kh√¥ng c√≥ d·ªØ li·ªáu ph√≤ng: " + room);
      }
    } catch (err) {
      console.error(err);
      if (heroStatus) heroStatus.textContent = "L·ªói g·ªçi roominfo";
    }
  }

  document.addEventListener("DOMContentLoaded", loadRoomInfoFromQuery);
})();
</script>

</body>
</html>







