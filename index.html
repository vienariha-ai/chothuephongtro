<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>YT Home ‚Äì Cho thu√™ ph√≤ng tr·ªç & cƒÉn h·ªô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --accent: #22c55e;
      --bg: #0f172a;
      --text: #0f172a;
      --muted: #6b7280;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --radius: 16px;
      --shadow-sm: 0 6px 18px rgba(15, 23, 42, 0.12);
      --shadow-md: 0 20px 45px rgba(15, 23, 42, 0.25);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.2), transparent 50%),
        radial-gradient(circle at top right, rgba(129, 140, 248, 0.2), transparent 55%),
        radial-gradient(circle at bottom, rgba(45, 212, 191, 0.25), transparent 55%),
        #0b1120;
      color: #e5e7eb;
      line-height: 1.6;
      min-height: 100vh;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    img {
      max-width: 100%;
      display: block;
    }

    .container {
      width: 100%;
      max-width: 1120px;
      margin: 0 auto;
      padding: 0 16px;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(14px);
      background: linear-gradient(
        to bottom,
        rgba(15, 23, 42, 0.9),
        rgba(15, 23, 42, 0.7),
        transparent
      );
      border-bottom: 1px solid rgba(148, 163, 184, 0.35);
    }

    .nav {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 0;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: #e5e7eb;
    }

    .logo-icon {
      width: 34px;
      height: 34px;
      border-radius: 14px;
      background: conic-gradient(from 120deg, #38bdf8, #22c55e, #6366f1, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0b1120;
      font-weight: 800;
      font-size: 1rem;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.8), 0 10px 30px rgba(15, 23, 42, 0.8);
    }

    .logo-sub {
      font-size: 0.7rem;
      font-weight: 500;
      text-transform: none;
      color: rgba(148, 163, 184, 0.9);
    }

    .nav-links {
      display: flex;
      gap: 18px;
      font-size: 0.9rem;
    }

    .nav-links a {
      color: rgba(209, 213, 219, 0.9);
      font-weight: 500;
      padding: 4px 0;
      position: relative;
      transition: color 0.12s ease, transform 0.12s ease;
    }

    .nav-links a::after {
      content: "";
      position: absolute;
      left: 0;
      bottom: -4px;
      width: 0;
      height: 2px;
      border-radius: 999px;
      background: linear-gradient(90deg, #38bdf8, #22c55e);
      transition: width 0.18s ease;
    }

    .nav-links a:hover {
      color: #f9fafb;
      transform: translateY(-1px);
    }

    .nav-links a:hover::after {
      width: 100%;
    }

    .nav-cta {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 18px;
      font-size: 0.88rem;
      font-weight: 600;
      border: 1px solid transparent;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: radial-gradient(circle at top left, #38bdf8, #2563eb);
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.45);
      transition:
        transform 0.16s ease,
        box-shadow 0.16s ease,
        filter 0.16s ease,
        background 0.16s ease;
    }

    .btn:hover {
      transform: translateY(-2px) translateZ(0);
      box-shadow: 0 16px 40px rgba(37, 99, 235, 0.7);
      filter: brightness(1.03);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.7);
    }

    .btn-outline {
      background: transparent;
      color: #e5e7eb;
      border-color: rgba(148, 163, 184, 0.7);
      box-shadow: none;
    }

    .btn-outline:hover {
      background: rgba(15, 23, 42, 0.9);
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.8);
      border-color: rgba(148, 163, 184, 1);
    }

    .hero {
      padding: 32px 0 26px;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 32px;
      align-items: center;
    }

    .badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: capitalize;
      transition: 0.25s ease;
    }

    .badge-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 4px rgba(34, 197, 94, 0.3);
    }

    .hero-title {
      font-size: clamp(2rem, 3vw, 2.4rem);
      font-weight: 800;
      letter-spacing: -0.04em;
      margin-bottom: 10px;
      color: #f9fafb;
    }

    .hero-highlight {
      background: linear-gradient(120deg, #38bdf8, #4f46e5, #22c55e);
      -webkit-background-clip: text;
      color: transparent;
    }

    .hero-subtitle {
      font-size: 0.98rem;
      color: rgba(148, 163, 184, 0.95);
      max-width: 480px;
      margin-bottom: 16px;
    }

    .hero-cta {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 18px;
    }

    .hero-note {
      font-size: 0.82rem;
      color: rgba(148, 163, 184, 0.9);
    }

    .hero-note strong {
      color: #e5e7eb;
    }

    .hero-stats {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-top: 20px;
    }

    .stat-card {
      border-radius: 14px;
      padding: 10px 12px;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.94));
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(12px);
    }

    .stat-value {
      font-size: 1.2rem;
      font-weight: 700;
      color: #e5e7eb;
    }

    .stat-label {
      font-size: 0.78rem;
      color: rgba(148, 163, 184, 0.9);
    }

    .hero-card {
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.2), rgba(15, 23, 42, 0.98));
      border-radius: 22px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      box-shadow: var(--shadow-md);
      padding: 16px;
      color: #e5e7eb;
      transform: translateZ(0);
      transition: transform 0.24s ease, box-shadow 0.24s ease;
    }

    .hero-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 26px 60px rgba(15, 23, 42, 0.9);
    }

    .hero-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .hero-card-title {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .hero-pill {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(22, 163, 74, 0.12);
      color: #4ade80;
      font-weight: 600;
      border: 1px solid rgba(74, 222, 128, 0.4);
    }

    /* üéØ BI·ªÇU ƒê·ªí T·ªîNG QUAN (BAR CHART) */
    .hero-chart {
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .hero-chart-row {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .hero-chart-top {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .hero-chart-label {
      color: rgba(148, 163, 184, 0.96);
    }

    .hero-chart-value {
      color: #e5e7eb;
      font-weight: 500;
    }

    .hero-chart-bar-bg {
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid rgba(51, 65, 85, 0.9);
      overflow: hidden;
    }

    .hero-chart-bar-fill {
      height: 100%;
      border-radius: 999px;
      width: 0;
      transition: width 0.4s ease-out;
    }

    .hero-chart-bar-available {
      background: linear-gradient(90deg, #22c55e, #4ade80);
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.7);
    }

    .hero-chart-bar-liked {
      background: linear-gradient(90deg, #fb923c, #f97316);
      box-shadow: 0 0 12px rgba(251, 146, 60, 0.7);
    }

    .hero-chart-bar-highrated {
      background: linear-gradient(90deg, #facc15, #eab308);
      box-shadow: 0 0 12px rgba(250, 204, 21, 0.7);
    }

    .hero-card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.75rem;
      margin-top: 6px;
    }

    .hero-badge-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .hero-badge {
      font-size: 0.68rem;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.8);
      background: rgba(15, 23, 42, 0.9);
    }

    section {
      padding: 28px 0;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 14px;
      gap: 10px;
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 700;
      color: #f9fafb;
    }

    .section-subtitle {
      font-size: 0.85rem;
      color: rgba(148, 163, 184, 0.95);
      max-width: 420px;
    }

    .filter-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 8px;
    }

    /* b·ªô l·ªçc n√¢ng cao: t·∫ßng, ƒë√°nh gi√°, quan t√¢m, gi√°, di·ªán t√≠ch */
    .filter-advanced {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 12px;
      margin-top: 4px;
    }

    .filter-select {
      min-width: 130px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      color: rgba(229, 231, 235, 0.96);
      font-size: 0.8rem;
      outline: none;
    }

    .filter-select:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.4);
    }

    .filter-pill {
      font-size: 0.8rem;
      padding: 5px 12px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: rgba(209, 213, 219, 0.9);
      cursor: pointer;
      transition: all 0.16s ease;
    }

    .filter-pill:hover {
      border-color: #38bdf8;
      color: #e5e7eb;
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.28), rgba(15, 23, 42, 0.98));
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.9);
      transform: translateY(-1px);
    }

    .filter-pill.active {
      border-color: #38bdf8;
      color: #e0f2fe;
      background: linear-gradient(120deg, rgba(56, 189, 248, 0.26), rgba(15, 23, 42, 0.96));
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.9);
    }

    /* üëâ THU NH·ªé CARD & TƒÇNG S·ªê C·ªòT */
    .rooms-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 10px;
    }

    .room-card {
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.98));
      border-radius: 14px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.9);
      padding: 8px 9px;
      font-size: 0.78rem;
      display: flex;
      flex-direction: column;
      gap: 3px;
      color: #e5e7eb;
      position: relative;
      overflow: hidden;
      transform: translateZ(0);
      transition:
        transform 0.2s ease,
        box-shadow 0.2s ease,
        border-color 0.2s ease,
        background 0.2s ease;
    }

    .room-line {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
      font-size: 0.78rem;
    }

    .room-card::before {
      content: "";
      position: absolute;
      inset: -40%;
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.12), transparent 65%);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.25s ease, transform 0.25s ease;
      pointer-events: none;
    }

    .room-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 22px 50px rgba(15, 23, 42, 0.95);
      border-color: rgba(56, 189, 248, 0.9);
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
    }

    .room-card:hover::before {
      opacity: 1;
      transform: translateY(0);
    }

    .room-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 4px;
      gap: 4px;
    }

    .room-actions {
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .rating {
      display: flex;
      align-items: center;
      gap: 2px;
      margin-right: 4px;
      font-size: 0.78rem;
    }

    .rating .star {
      cursor: pointer;
      color: #fbbf24;
      opacity: 0.35;
      transition: transform 0.12s ease, opacity 0.12s ease;
    }

    .rating .star.active {
      opacity: 1;
    }

    .rating .star:hover {
      transform: translateY(-1px) scale(1.05);
      opacity: 1;
    }

    .rating-text {
      font-size: 0.7rem;
      color: rgba(148, 163, 184, 0.95);
      margin-left: 4px;
    }

    .icon-btn {
      width: 26px;
      height: 26px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.95);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      cursor: pointer;
      color: rgba(229, 231, 235, 0.95);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.9);
      transition: transform 0.16s ease, box-shadow 0.16s ease, border-color 0.16s ease,
        background 0.16s ease, filter 0.16s ease;
    }

    .icon-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.95);
      border-color: rgba(56, 189, 248, 0.9);
      filter: brightness(1.05);
    }

    .icon-btn:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.9);
    }

    .icon-btn.like-btn-liked {
      background: #fb923c;
      border-color: #fed7aa;
      color: #0b1120;
    }

    .like-count {
      font-size: 0.7rem;
      min-width: 18px;
      text-align: right;
    }

    .room-btn {
      font-size: 0.74rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: none;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.22), rgba(37, 99, 235, 0.96));
      color: #e5e7eb;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 8px 22px rgba(37, 99, 235, 0.7);
      transition: transform 0.16s ease, box-shadow 0.16s ease, filter 0.16s ease;
    }

    .room-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 36px rgba(37, 99, 235, 0.9);
      filter: brightness(1.05);
    }

    .room-btn:active {
      transform: translateY(0);
      box-shadow: 0 10px 24px rgba(15, 23, 42, 0.9);
    }
    .room-btn-secondary {
      font-size: 0.74rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.98);
      color: #e5e7eb;
      cursor: pointer;
      font-weight: 600;
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.8);
      transition: transform 0.16s ease, box-shadow 0.16s ease, filter 0.16s ease,
        border-color 0.16s ease;
    }

    .room-btn-secondary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.95);
      filter: brightness(1.05);
      border-color: rgba(56, 189, 248, 0.9);
    }

    /* MODAL ƒêƒÇNG NH·∫¨P & PORTAL PH√íNG */
    .room-modal {
      position: fixed;
      inset: 0;
      z-index: 90;
      display: none;
    }

    .room-modal.show {
      display: block;
    }

    .room-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(4px);
    }

    .room-modal-content {
      position: relative;
      max-width: 520px;
      width: 92%;
      max-height: 80vh;
      margin: 40px auto;
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), #020617);
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      box-shadow: 0 24px 60px rgba(15, 23, 42, 0.96);
      overflow: hidden;
      padding: 16px 16px 18px;
      color: #e5e7eb;
      font-size: 0.85rem;
    }

    .room-modal-close {
      position: absolute;
      top: 8px;
      right: 8px;
      border: none;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 1rem;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: #f9fafb;
    }

    .room-modal-title {
      font-size: 1rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .room-modal-subtitle {
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.95);
      margin-bottom: 8px;
    }

    .portal-section {
      margin-top: 10px;
      padding-top: 8px;
      border-top: 1px solid rgba(51, 65, 85, 0.9);
    }

    .portal-section h4 {
      font-size: 0.9rem;
      margin-bottom: 4px;
    }

    .portal-list {
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.96);
    }

    .portal-list-item {
      padding: 4px 0;
      border-bottom: 1px dashed rgba(51, 65, 85, 0.9);
    }

    .room-status-chip {
      font-size: 0.68rem;
      padding: 3px 8px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.95);
      white-space: nowrap;
    }

    /* üëâ Ph√≤ng C√íN TR·ªêNG: n·ªÅn xanh l√° r√µ r√†ng */
    .room-status-chip.status-available {
      background: #22c55e;
      color: #022c22;
      border-color: #22c55e;
    }

    /* üëâ Ph√≤ng ƒêANG THU√ä: n·ªÅn x√°m ƒë·∫≠m */
    .room-status-chip.status-rented {
      background: #4b5563;
      color: #e5e7eb;
      border-color: #6b7280;
    }

    .feature-grid,
    .process-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
    }

    .card {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.99));
      border-radius: 16px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 16px 36px rgba(15, 23, 42, 0.95);
      padding: 12px;
      font-size: 0.85rem;
      color: #e5e7eb;
      transition: transform 0.18s ease, box-shadow 0.18s ease, border-color 0.18s ease;
    }

    .card:hover {
      transform: translateY(-3px);
      box-shadow: 0 24px 56px rgba(15, 23, 42, 0.95);
      border-color: rgba(56, 189, 248, 0.9);
    }

    .card-title {
      font-size: 0.92rem;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .card-icon {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.22), rgba(37, 99, 235, 0.95));
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.15rem;
      margin-bottom: 6px;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.75);
    }

    .card ul {
      padding-left: 18px;
      margin-top: 4px;
    }

    .card li {
      margin-bottom: 2px;
    }

    .contact-grid {
      display: grid;
      grid-template-columns: 1.1fr 1fr;
      gap: 16px;
    }

    .contact-info p {
      font-size: 0.85rem;
      color: rgba(148, 163, 184, 0.98);
      margin-bottom: 4px;
    }

    .contact-highlight {
      font-size: 1.05rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: #e5e7eb;
    }

    .contact-form {
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), rgba(15, 23, 42, 0.98));
      border-radius: 16px;
      padding: 12px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      box-shadow: 0 18px 46px rgba(15, 23, 42, 0.96);
      font-size: 0.85rem;
    }

    .form-group {
      margin-bottom: 8px;
    }

    .form-group label {
      display: block;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 2px;
      color: rgba(209, 213, 219, 0.98);
    }

    .form-control {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.75);
      padding: 6px 8px;
      font-size: 0.85rem;
      outline: none;
      background: rgba(15, 23, 42, 0.96);
      color: #e5e7eb;
      transition: border-color 0.16s ease, box-shadow 0.16s ease, background 0.16s ease;
    }

    .form-control:focus {
      border-color: #38bdf8;
      box-shadow: 0 0 0 1px rgba(56, 189, 248, 0.45);
      background: rgba(15, 23, 42, 0.98);
    }

    textarea.form-control {
      resize: vertical;
      min-height: 80px;
    }

    footer {
      padding: 18px 0 22px;
      font-size: 0.78rem;
      color: rgba(148, 163, 184, 0.95);
      border-top: 1px solid rgba(148, 163, 184, 0.6);
      margin-top: 12px;
    }

    footer .footer-row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    /* MODAL VIDEO */
    .video-modal {
      position: fixed;
      inset: 0;
      z-index: 80;
      display: none;
    }

    .video-modal.show {
      display: block;
    }

    .video-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(3px);
    }

    .video-modal-content {
      position: relative;
      max-width: 840px;
      width: 92%;
      max-height: 80vh;
      margin: 40px auto;
      background: #000;
      border-radius: 16px;
      box-shadow: 0 26px 70px rgba(15, 23, 42, 0.95);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .video-modal-close {
      position: absolute;
      top: 8px;
      right: 8px;
      border: none;
      border-radius: 999px;
      padding: 4px 8px;
      font-size: 1rem;
      cursor: pointer;
      z-index: 2;
      background: rgba(15, 23, 42, 0.85);
      color: #f9fafb;
    }

    #videoContainer {
      width: 100%;
      padding-top: 56.25%;
      position: relative;
    }

    #videoContainer iframe,
    #videoContainer video {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    /* ========== T√ÄI KHO·∫¢N PH√íNG / ƒêƒÇNG NH·∫¨P ========== */
    .auth-modal {
      position: fixed;
      inset: 0;
      z-index: 90;
      display: none;
    }

    .auth-modal.show {
      display: block;
    }

    .auth-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.8);
      backdrop-filter: blur(4px);
    }

    .auth-modal-card {
      position: relative;
      max-width: 420px;
      width: 92%;
      margin: 60px auto;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 0.99));
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 24px 64px rgba(15, 23, 42, 0.96);
      padding: 16px 16px 14px;
      font-size: 0.85rem;
    }

    .auth-modal-close {
      position: absolute;
      top: 6px;
      right: 8px;
      border: none;
      border-radius: 999px;
      padding: 2px 6px;
      font-size: 0.9rem;
      cursor: pointer;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
    }

    .auth-title {
      font-size: 1rem;
      font-weight: 700;
      margin-bottom: 4px;
      color: #f9fafb;
    }

    .auth-subtitle {
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.96);
      margin-bottom: 8px;
    }

    #tenantLoginStatus {
      margin-top: 4px;
      font-size: 0.78rem;
      color: rgba(148, 163, 184, 0.96);
      min-height: 16px;
    }

    /* ========== PORTAL T√ÄI KHO·∫¢N PH√íNG ========== */
    .tenant-portal {
      border-top: 1px solid rgba(148, 163, 184, 0.45);
      padding-top: 24px;
    }

    .tenant-welcome {
      font-size: 0.9rem;
      color: rgba(226, 232, 240, 0.98);
      margin-bottom: 10px;
    }

    .tenant-welcome strong {
      color: #f9fafb;
    }

    .tenant-tabs {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 10px;
    }

    .tenant-tab {
      font-size: 0.8rem;
      padding: 6px 13px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: rgba(226, 232, 240, 0.96);
      cursor: pointer;
      transition: all 0.16s ease;
    }

    .tenant-tab:hover {
      border-color: #38bdf8;
      background: radial-gradient(circle at top, rgba(56, 189, 248, 0.22), rgba(15, 23, 42, 0.99));
      box-shadow: 0 10px 28px rgba(15, 23, 42, 0.95);
    }

    .tenant-tab.active {
      border-color: #38bdf8;
      background: linear-gradient(120deg, rgba(56, 189, 248, 0.28), rgba(15, 23, 42, 0.98));
      color: #e0f2fe;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.98);
    }

    .tenant-panel {
      display: none;
      margin-top: 4px;
    }

    .tenant-panel.active {
      display: block;
    }

    .tenant-status-text {
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.98);
      margin-top: 2px;
    }

    .tenant-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
      margin-top: 6px;
    }

    .tenant-table th,
    .tenant-table td {
      padding: 4px 6px;
      border-bottom: 1px solid rgba(51, 65, 85, 0.9);
      text-align: left;
    }

    .tenant-table th {
      font-weight: 600;
      color: rgba(226, 232, 240, 0.98);
    }

    .tenant-table td {
      color: rgba(203, 213, 225, 0.98);
    }

    .tenant-history-list {
      margin-top: 6px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 0.8rem;
    }

    .tenant-history-item {
      padding: 6px 8px;
      border-radius: 10px;
      border: 1px solid rgba(51, 65, 85, 0.9);
      background: rgba(15, 23, 42, 0.96);
    }

    .tenant-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.8);
      font-size: 0.7rem;
      margin-right: 4px;
    }

    .tenant-form-note {
      font-size: 0.78rem;
      color: rgba(148, 163, 184, 0.96);
      margin-top: 4px;
    }

    #maintenanceStatus,
    #tempStayStatus {
      margin-top: 4px;
      font-size: 0.78rem;
      color: rgba(148, 163, 184, 0.96);
      min-height: 16px;
    }

    @media (max-width: 900px) {
      .hero-grid,
      .contact-grid {
        grid-template-columns: 1fr;
      }

      .rooms-grid,
      .feature-grid,
      .process-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 640px) {
      .nav-links {
        display: none;
      }

      .hero {
        padding-top: 22px;
      }

      .hero-title {
        font-size: 1.8rem;
      }

      .rooms-grid,
      .feature-grid,
      .process-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="container">
      <div class="nav">
        <div class="logo">
          <div class="logo-icon">YT</div>
          <div>
            <div>YT Home</div>
            <div class="logo-sub">Kh√¥ng gian s·ªëng an to√†n & ti·ªán nghi</div>
          </div>
        </div>
        <nav class="nav-links">
          <a href="#rooms">Ph√≤ng tr·ªç & CƒÉn h·ªô</a>
          <a href="#features">Ti·ªán √≠ch</a>
          <a href="#process">Quy tr√¨nh thu√™</a>
          <a href="#contact">Li√™n h·ªá</a>
        </nav>
        <div class="nav-cta">
          <!-- N√∫t t√†i kho·∫£n ph√≤ng -->
          <button class="btn-outline btn" type="button" id="tenantLoginBtn" onclick="openLoginModal()">
            <span id="tenantLoginBtnLabel">T√†i kho·∫£n ph√≤ng</span>
          </button>
          <button class="btn-outline btn" type="button" onclick="scrollToSection('contact')">G·ªçi t∆∞ v·∫•n</button>
          <button class="btn" type="button" onclick="scrollToSection('rooms')">Xem ph√≤ng</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container">
        <div class="hero-grid">
          <div>
            <div class="badge">
              <span class="badge-dot"></span>
              <span>YT Home ‚Äì 34 ph√≤ng tr·ªç & cƒÉn h·ªô</span>
            </div>
            <h1 class="hero-title">
              Thu√™ ph√≤ng d·ªÖ d√†ng t·∫°i
              <span class="hero-highlight">YT Home</span>
            </h1>
            <p class="hero-subtitle">
              H·ªá th·ªëng ph√≤ng tr·ªç v√† cƒÉn h·ªô mini ƒë·∫ßy ƒë·ªß n·ªôi th·∫•t, an ninh, gi·ªù gi·∫•c linh ho·∫°t,
              ph√π h·ª£p sinh vi√™n, nh√¢n vi√™n vƒÉn ph√≤ng v√† gia ƒë√¨nh tr·∫ª.
            </p>

            <div class="hero-cta">
              <button class="btn" onclick="scrollToSection('rooms')">Xem danh s√°ch ph√≤ng</button>
              <button class="btn-outline btn" onclick="scrollToSection('contact')">ƒê·∫∑t l·ªãch xem ph√≤ng</button>
            </div>

            <p class="hero-note">
              <strong>Cam k·∫øt:</strong> H·ª£p ƒë·ªìng r√µ r√†ng ‚Äì Kh√¥ng thu ph√≠ m√¥i gi·ªõi ‚Äì H·ªó tr·ª£ online 24/7.
            </p>

            <div class="hero-stats">
              <div class="stat-card">
                <div class="stat-value" id="statTotalRooms">--</div>
                <div class="stat-label">Ph√≤ng & cƒÉn h·ªô</div>
              </div>
              <div class="stat-card">
                <div class="stat-value">3</div>
                <div class="stat-label">Lo·∫°i ph√≤ng (ƒë∆°n, ƒë√¥i, cƒÉn h·ªô)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statAvailable">--</div>
                <div class="stat-label">Ph√≤ng c√≤n tr·ªëng</div>
              </div>
            </div>
          </div>

          <div>
            <div class="hero-card">
              <div class="hero-card-header">
                <div class="hero-card-title">T·ªïng quan t√≤a nh√† YT Home</div>
                <div class="hero-pill" id="heroStatus">ƒêang t·∫£i...</div>
              </div>

              <!-- BI·ªÇU ƒê·ªí T·ªîNG QUAN -->
              <div class="hero-chart" id="heroOverview"></div>

              <div class="hero-card-footer">
                <div class="hero-badge-row">
                  <div class="hero-badge">Thang m√°y & g·ª≠i xe</div>
                  <div class="hero-badge">Camera an ninh 24/7</div>
                  <div class="hero-badge">Wifi t·ªëc ƒë·ªô cao</div>
                </div>
                <div>Gi√° t·ª´ <strong>2.8 ‚Äì 6 tri·ªáu/th√°ng</strong> (tham kh·∫£o)</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ROOMS LIST -->
    <section id="rooms">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Danh s√°ch ph√≤ng tr·ªç & cƒÉn h·ªô</div>
            <p class="section-subtitle">
              Ph√≤ng ƒë∆∞·ª£c s·∫Øp x·∫øp theo t·∫ßng (tr·ªát, t·∫ßng 1, 2, 3, 4, 5). B·∫°n c√≥ th·ªÉ l·ªçc theo lo·∫°i, t√¨nh tr·∫°ng, t·∫ßng, gi√°, di·ªán t√≠ch, ƒë√°nh gi√° v√† m·ª©c ƒë·ªô quan t√¢m.
            </p>
          </div>
        </div>

        <!-- L·ªçc theo lo·∫°i ph√≤ng & t√¨nh tr·∫°ng -->
        <div class="filter-bar">
          <button class="filter-pill active" data-filter="all">T·∫•t c·∫£</button>
          <button class="filter-pill" data-filter="Ph√≤ng ƒë∆°n">Ph√≤ng ƒë∆°n</button>
          <button class="filter-pill" data-filter="Ph√≤ng ƒë√¥i">Ph√≤ng ƒë√¥i</button>
          <button class="filter-pill" data-filter="CƒÉn h·ªô mini">CƒÉn h·ªô mini</button>
          <button class="filter-pill" data-filter="available">C√≤n tr·ªëng</button>
        </div>

        <!-- B·ªô l·ªçc n√¢ng cao: t·∫ßng, ƒë√°nh gi√°, quan t√¢m, gi√°, di·ªán t√≠ch -->
        <div class="filter-advanced">
          <select id="filterFloor" class="filter-select">
            <option value="all">T·∫•t c·∫£ t·∫ßng</option>
            <option value="0">Tr·ªát</option>
            <option value="1">T·∫ßng 1</option>
            <option value="2">T·∫ßng 2</option>
            <option value="3">T·∫ßng 3</option>
            <option value="4">T·∫ßng 4</option>
            <option value="5">T·∫ßng 5</option>
          </select>

          <select id="filterRating" class="filter-select">
            <option value="all">T·∫•t c·∫£ ƒë√°nh gi√°</option>
            <option value="rated">Ch·ªâ ph√≤ng ƒë√£ c√≥ ƒë√°nh gi√°</option>
            <option value="3plus">T·ª´ 3‚òÖ tr·ªü l√™n</option>
            <option value="4plus">T·ª´ 4‚òÖ tr·ªü l√™n</option>
          </select>

          <select id="filterInterest" class="filter-select">
            <option value="all">Quan t√¢m (t·∫•t c·∫£)</option>
            <option value="liked">Ch·ªâ ph√≤ng ƒë√£ b·∫•m ‚ô•</option>
          </select>

          <select id="filterPrice" class="filter-select">
            <option value="all">Gi√° (t·∫•t c·∫£)</option>
            <option value="lt3">D∆∞·ªõi 3 tri·ªáu</option>
            <option value="3-35">3 ‚Äì 3.5 tri·ªáu</option>
            <option value="35-4">3.5 ‚Äì 4 tri·ªáu</option>
            <option value="gt4">Tr√™n 4 tri·ªáu</option>
          </select>

          <select id="filterArea" class="filter-select">
            <option value="all">Di·ªán t√≠ch (t·∫•t c·∫£)</option>
            <option value="lt18">D∆∞·ªõi 18 m¬≤</option>
            <option value="18-25">18 ‚Äì 25 m¬≤</option>
            <option value="gt25">Tr√™n 25 m¬≤</option>
          </select>
        </div>

        <div class="rooms-grid" id="roomsGrid"></div>
        <p id="roomsStatus" style="margin-top:8px; font-size:0.8rem; color:rgba(148,163,184,0.95);">
          ƒêang t·∫£i d·ªØ li·ªáu ph√≤ng...
        </p>
      </div>
    </section>

    <!-- FEATURES -->
    <section id="features">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Ti·ªán √≠ch t·∫°i YT Home</div>
            <p class="section-subtitle">
              T·∫≠p trung v√†o tr·∫£i nghi·ªám s·ªëng an to√†n, s·∫°ch s·∫Ω, ƒë·∫ßy ƒë·ªß ti·ªán nghi, h·ªó tr·ª£ t·ªëi ƒëa cho c∆∞ d√¢n.
            </p>
          </div>
        </div>
        <div class="feature-grid">
          <div class="card">
            <div class="card-icon">üè†</div>
            <div class="card-title">Ph√≤ng m·ªõi, ƒë·∫ßy ƒë·ªß n·ªôi th·∫•t</div>
            <p>
              Gi∆∞·ªùng, t·ªß, m√°y l·∫°nh, m√°y n∆∞·ªõc n√≥ng, b·∫øp (tu·ª≥ lo·∫°i ph√≤ng), ban c√¥ng tho√°ng m√°t.
            </p>
          </div>
          <div class="card">
            <div class="card-icon">üõ°Ô∏è</div>
            <div class="card-title">An ninh 24/7</div>
            <p>
              Camera to√†n khu, c·ª≠a kho√° t·ª´/ v√¢n tay, b√£i xe c√≥ m√°i che, qu·∫£n l√Ω h·ªó tr·ª£ khi c·∫ßn.
            </p>
          </div>
          <div class="card">
            <div class="card-icon">üåê</div>
            <div class="card-title">K·∫øt n·ªëi & ti·ªán √≠ch xung quanh</div>
            <p>
              G·∫ßn ch·ª£, si√™u th·ªã, tr·∫°m xe bu√Ωt, b·ªánh vi·ªán, tr∆∞·ªùng h·ªçc; ph√π h·ª£p ng∆∞·ªùi ƒëi l√†m & sinh vi√™n.
            </p>
          </div>
          <div class="card">
            <div class="card-icon">üßæ</div>
            <div class="card-title">Chi ph√≠ r√µ r√†ng</div>
            <p>
              ƒêi·ªán, n∆∞·ªõc, wifi, ph√≠ gi·ªØ xe minh b·∫°ch; h·ª£p ƒë·ªìng r√µ r√†ng; kh√¥ng thu th√™m ph√≠ m√¥i gi·ªõi.
            </p>
          </div>
          <div class="card">
            <div class="card-icon">üßπ</div>
            <div class="card-title">Kh√¥ng gian s·∫°ch & xanh</div>
            <p>
              Khu v·ª±c chung ƒë∆∞·ª£c v·ªá sinh ƒë·ªãnh k·ª≥; khuy·∫øn kh√≠ch ph√¢n lo·∫°i r√°c, s·ªëng xanh.
            </p>
          </div>
          <div class="card">
            <div class="card-icon">ü§ù</div>
            <div class="card-title">Ch·ªß nh√† th√¢n thi·ªán</div>
            <p>
              H·ªó tr·ª£ th·ªß t·ª•c c∆∞ tr√∫, chia s·∫ª th√¥ng tin khu v·ª±c; ∆∞u ti√™n c∆∞ d√¢n ·ªü l√¢u d√†i, vƒÉn minh.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- PROCESS -->
    <section id="process">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Quy tr√¨nh thu√™ ph√≤ng t·∫°i YT Home</div>
            <p class="section-subtitle">
              Ch·ªâ v·ªõi 4 b∆∞·ªõc ƒë∆°n gi·∫£n, b·∫°n ƒë√£ c√≥ th·ªÉ d·ªçn v√†o cƒÉn ph√≤ng m·ªõi c·ªßa m√¨nh.
            </p>
          </div>
        </div>

        <div class="process-grid">
          <div class="card">
            <div class="card-icon">üîç</div>
            <div class="card-title">B∆∞·ªõc 1 ‚Äì Ch·ªçn ph√≤ng</div>
            <ul>
              <li>Xem danh s√°ch ph√≤ng c√≤n tr·ªëng tr√™n website.</li>
              <li>L·ªçc theo lo·∫°i ph√≤ng, di·ªán t√≠ch, gi√°.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">üìÖ</div>
            <div class="card-title">B∆∞·ªõc 2 ‚Äì ƒê·∫∑t l·ªãch xem</div>
            <ul>
              <li>Li√™n h·ªá qua ƒëi·ªán tho·∫°i/ Zalo/ form d∆∞·ªõi.</li>
              <li>Ch·ªçn gi·ªù xem ph√≤ng ph√π h·ª£p.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">üè°</div>
            <div class="card-title">B∆∞·ªõc 3 ‚Äì Xem & ch·ªët ph√≤ng</div>
            <ul>
              <li>Tham quan th·ª±c t·∫ø ph√≤ng & khu v·ª±c chung.</li>
              <li>Th·ªëng nh·∫•t gi√°, c·ªçc, th·ªùi gian ·ªü.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">‚úçÔ∏è</div>
            <div class="card-title">B∆∞·ªõc 4 ‚Äì K√Ω h·ª£p ƒë·ªìng</div>
            <ul>
              <li>K√Ω h·ª£p ƒë·ªìng thu√™ r√µ r√†ng, minh b·∫°ch.</li>
              <li>Nh·∫≠n ch√¨a kh√≥a, d·ªçn v√†o ·ªü.</li>
            </ul>
          </div>
          <div class="card">
            <div class="card-icon">üì≤</div>
            <div class="card-title">H·ªó tr·ª£ trong su·ªët th·ªùi gian ·ªü</div>
            <ul>
              <li>Li√™n h·ªá ch·ªß nh√† khi c·∫ßn s·ª≠a ch·ªØa, h·ªó tr·ª£.</li>
              <li>Gia h·∫°n h·ª£p ƒë·ªìng linh ho·∫°t.</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- TENANT PORTAL: T√†i kho·∫£n ph√≤ng -->
    <section id="tenantPortal" class="tenant-portal" style="display:none;">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">T√†i kho·∫£n ph√≤ng</div>
            <p class="section-subtitle">
              Sau khi ƒëƒÉng nh·∫≠p b·∫±ng m√£ ph√≤ng, c∆∞ d√¢n c√≥ th·ªÉ xem h√≥a ƒë∆°n, b√°o h·ªèng v√† ƒëƒÉng k√Ω t·∫°m tr√∫ tr·ª±c tuy·∫øn.
            </p>
          </div>
          <div>
            <button class="btn-outline btn" type="button" onclick="logoutTenant()">ƒêƒÉng xu·∫•t</button>
          </div>
        </div>

        <div class="tenant-welcome">
          Xin ch√†o <strong id="tenantWelcomeName"></strong> ¬∑ Ph√≤ng <span id="tenantWelcomeRoom"></span>
        </div>

        <div class="tenant-tabs">
          <button class="tenant-tab active" data-tab="tenantBills">H√≥a ƒë∆°n & thanh to√°n</button>
          <button class="tenant-tab" data-tab="tenantMaintenance">B√°o h·ªèng / s·ª≠a ch·ªØa</button>
          <button class="tenant-tab" data-tab="tenantTempStay">ƒêƒÉng k√Ω t·∫°m tr√∫</button>
          <button class="tenant-tab" data-tab="tenantHistory">Y√™u c·∫ßu ƒë√£ g·ª≠i</button>
        </div>

        <div class="tenant-tab-panels">
          <!-- H√≥a ƒë∆°n -->
          <div id="tenantBills" class="tenant-panel active">
            <div id="tenantBillsStatus" class="tenant-status-text">ƒêang t·∫£i h√≥a ƒë∆°n...</div>
            <table class="tenant-table" id="tenantBillsTable">
              <thead>
                <tr>
                  <th>Th√°ng</th>
                  <th>T·ªïng ti·ªÅn</th>
                  <th>Tr·∫°ng th√°i</th>
                  <th>H·∫°n thanh to√°n</th>
                  <th>Chi ti·∫øt</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- B√°o h·ªèng -->
          <div id="tenantMaintenance" class="tenant-panel">
            <form id="maintenanceForm">
              <div class="form-group">
                <label for="maintenanceCategory">H·∫°ng m·ª•c h∆∞ h·ªèng</label>
                <select id="maintenanceCategory" class="form-control" required>
                  <option value="">-- Ch·ªçn h·∫°ng m·ª•c --</option>
                  <option>ƒêi·ªán</option>
                  <option>N∆∞·ªõc</option>
                  <option>N·ªôi th·∫•t (gi∆∞·ªùng, t·ªß...)</option>
                  <option>Thi·∫øt b·ªã (m√°y l·∫°nh, m√°y n∆∞·ªõc n√≥ng...)</option>
                  <option>Kh√°c</option>
                </select>
              </div>
              <div class="form-group">
                <label for="maintenanceDesc">M√¥ t·∫£ chi ti·∫øt</label>
                <textarea id="maintenanceDesc" class="form-control" required
                  placeholder="V√≠ d·ª•: V√≤i n∆∞·ªõc trong nh√† t·∫Øm b·ªã r√≤, ch·∫£y li√™n t·ª•c t·ª´ t·ªëi qua..."></textarea>
              </div>
              <div class="form-group">
                <label for="maintenanceTime">Th·ªùi gian thu·∫≠n ti·ªán ƒë·ªÉ ki·ªÉm tra (d·ª± ki·∫øn)</label>
                <input id="maintenanceTime" class="form-control" type="text"
                       placeholder="V√≠ d·ª•: Sau 18h c√°c ng√†y trong tu·∫ßn ho·∫∑c s√°ng Ch·ªß Nh·∫≠t" />
              </div>
              <button type="submit" class="btn" style="width:100%; justify-content:center;">
                G·ª≠i y√™u c·∫ßu s·ª≠a ch·ªØa
              </button>
              <p id="maintenanceStatus"></p>
              <p class="tenant-form-note">
                Y√™u c·∫ßu c·ªßa b·∫°n s·∫Ω ƒë∆∞·ª£c ghi nh·∫≠n tr√™n h·ªá th·ªëng. Qu·∫£n l√Ω s·∫Ω li√™n h·ªá l·∫°i ƒë·ªÉ x√°c nh·∫≠n th·ªùi gian s·ª≠a ch·ªØa.
              </p>
            </form>
          </div>

          <!-- ƒêƒÉng k√Ω t·∫°m tr√∫ -->
          <div id="tenantTempStay" class="tenant-panel">
            <form id="tempStayForm">
              <div class="form-group">
                <label for="tempGuestName">H·ªç t√™n ng∆∞·ªùi t·∫°m tr√∫</label>
                <input id="tempGuestName" class="form-control" type="text" required />
              </div>
              <div class="form-group">
                <label for="tempGuestId">S·ªë CCCD/CMND</label>
                <input id="tempGuestId" class="form-control" type="text" required />
              </div>
              <div class="form-group">
                <label for="tempStayFrom">Th·ªùi gian t·∫°m tr√∫</label>
                <input id="tempStayFrom" class="form-control" type="text"
                       placeholder="V√≠ d·ª•: t·ª´ 10/12/2025 ƒë·∫øn 15/12/2025" required />
              </div>
              <div class="form-group">
                <label for="tempStayNote">Ghi ch√∫ th√™m (n·∫øu c√≥)</label>
                <textarea id="tempStayNote" class="form-control"
                          placeholder="V√≠ d·ª•: Ng∆∞·ªùi th√¢n ·ªü qu√™ l√™n kh√°m b·ªánh..."></textarea>
              </div>
              <button type="submit" class="btn" style="width:100%; justify-content:center;">
                G·ª≠i ƒëƒÉng k√Ω t·∫°m tr√∫
              </button>
              <p id="tempStayStatus"></p>
              <p class="tenant-form-note">
                YT Home s·∫Ω d√πng th√¥ng tin n√†y ƒë·ªÉ h·ªó tr·ª£ khai b√°o t·∫°m tr√∫/t·∫°m v·∫Øng theo quy ƒë·ªãnh ƒë·ªãa ph∆∞∆°ng.
              </p>
            </form>
          </div>

          <!-- L·ªãch s·ª≠ y√™u c·∫ßu -->
          <div id="tenantHistory" class="tenant-panel">
            <div id="tenantHistoryStatus" class="tenant-status-text">ƒêang t·∫£i d·ªØ li·ªáu...</div>
            <div id="tenantHistoryList" class="tenant-history-list"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CONTACT -->
    <section id="contact">
      <div class="container">
        <div class="section-header">
          <div>
            <div class="section-title">Li√™n h·ªá YT Home</div>
            <p class="section-subtitle">
              ƒêi·ªÅn th√¥ng tin b√™n d∆∞·ªõi ho·∫∑c nh·∫Øn tr·ª±c ti·∫øp qua Zalo/ƒêi·ªán tho·∫°i ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n nhanh nh·∫•t.
            </p>
          </div>
        </div>

        <div class="contact-grid">
          <div class="contact-info">
            <p class="contact-highlight">S·∫µn s√†ng h·ªó tr·ª£ b·∫°n t√¨m ph√≤ng ph√π h·ª£p üí¨</p>
            <p><strong>ƒê·ªãa ch·ªâ:</strong> Ph∆∞·ªùng T√¢n B√¨nh, Tp. HCM</p>
            <p><strong>ƒêi·ªán tho·∫°i/Zalo:</strong> YT Home </p>
            <p><strong>Email:</strong>sale@thuephongtanbinh.com</p>
            <p style="margin-top: 8px;">
              B·∫°n c√≥ th·ªÉ ghi r√µ lo·∫°i ph√≤ng mong mu·ªën (ƒë∆°n, ƒë√¥i, cƒÉn h·ªô), kho·∫£ng gi√° 
              v√† th·ªùi gian d·ªçn v√†o. Ch√∫ng t√¥i s·∫Ω ph·∫£n h·ªìi trong th·ªùi gian s·ªõm nh·∫•t.
            </p>
          </div>

          <form class="contact-form" id="contactForm">
            <div class="form-group">
              <label for="name">H·ªç v√† t√™n</label>
              <input id="name" class="form-control" type="text" required />
            </div>
            <div class="form-group">
              <label for="phone">S·ªë ƒëi·ªán tho·∫°i/Zalo</label>
              <input id="phone" class="form-control" type="tel" required />
            </div>
            <div class="form-group">
              <label for="roomType">Lo·∫°i ph√≤ng quan t√¢m</label>
              <select id="roomType" class="form-control">
                <option value="">-- Ch·ªçn lo·∫°i ph√≤ng --</option>
                <option>Ph√≤ng ƒë∆°n</option>
                <option>Ph√≤ng ƒë√¥i</option>
                <option>CƒÉn h·ªô mini</option>
                <option>Ch∆∞a x√°c ƒë·ªãnh, c·∫ßn t∆∞ v·∫•n</option>
              </select>
            </div>
            <div class="form-group">
              <label for="message">N·ªôi dung</label>
              <textarea id="message" class="form-control" placeholder="V√≠ d·ª•: C·∫ßn ph√≤ng ƒë∆°n, gi√° kho·∫£ng 3‚Äì3.5 tri·ªáu, d·ªçn v√†o ƒë·∫ßu th√°ng t·ªõi..."></textarea>
            </div>
            <button type="submit" class="btn" style="width: 100%; justify-content: center;">
              G·ª≠i y√™u c·∫ßu t∆∞ v·∫•n
            </button>
            <p id="formStatus" style="margin-top: 6px; font-size: 0.8rem; color: rgba(148,163,184,0.96);"></p>

            <div style="margin-top:10px; font-size:0.8rem; color:rgba(148,163,184,0.96);">
              Ho·∫∑c li√™n h·ªá nhanh:
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
              <a id="zaloQuickLink" class="btn-outline btn"
                 href="#"
                 target="_blank" rel="noopener noreferrer"
                 style="padding:6px 14px; font-size:0.78rem;">
                Nh·∫Øn Zalo
              </a>

              <a id="emailQuickLink" class="btn-outline btn"
                 href="#"
                 style="padding:6px 14px; font-size:0.78rem;">
                G·ª≠i Email
              </a>

              <a id="messengerQuickLink" class="btn-outline btn"
                 href="#"
                 target="_blank" rel="noopener noreferrer"
                 style="padding:6px 14px; font-size:0.78rem;">
                Chat Messenger
              </a>
            </div>

          </form>
        </div>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="footer-row">
        <div>¬© <span id="year"></span> YT Home.</div>
        <div>C√≥ th·ªÉ m·ªü r·ªông th√™m: ƒëƒÉng nh·∫≠p, qu·∫£n l√Ω h·ª£p ƒë·ªìng, b√°o c√°o thu ‚Äì chi.</div>
      </div>
    </div>
  </footer>

  <!-- MODAL ƒêƒÇNG NH·∫¨P PH√íNG -->
  <div id="roomLoginModal" class="room-modal">
    <div class="room-modal-backdrop" onclick="closeRoomLoginModal()"></div>
    <div class="room-modal-content">
      <button type="button" class="room-modal-close" onclick="closeRoomLoginModal()">‚úï</button>
      <div class="room-modal-title">ƒêƒÉng nh·∫≠p t√†i kho·∫£n ph√≤ng</div>
      <div class="room-modal-subtitle">
        Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ch·ªß ph√≤ng ƒë·ªÉ xem th√¥ng tin ho√° ƒë∆°n, h·ª£p ƒë·ªìng, t·∫°m tr√∫ v√† b√°o h·ªèng.
      </div>

      <form id="roomLoginForm">
        <div class="form-group">
          <label>M√£ ph√≤ng</label>
          <input id="loginRoomId" class="form-control" type="text" readonly />
        </div>
        <div class="form-group">
          <label for="loginPhone">S·ªë ƒëi·ªán tho·∫°i ch·ªß ph√≤ng</label>
          <input id="loginPhone" class="form-control" type="tel" required
                 placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ƒë√£ ƒëƒÉng k√Ω trong H·ª£p ƒë·ªìng" />
        </div>
        <button type="submit" class="btn" style="width:100%;justify-content:center;">
          X√°c nh·∫≠n & m·ªü chi ti·∫øt ph√≤ng
        </button>
        <p id="roomLoginStatus"
           style="margin-top:6px;font-size:0.8rem;color:rgba(148,163,184,0.96);"></p>
      </form>
    </div>
  </div>

  <!-- MODAL PORTAL CHI TI·∫æT PH√íNG -->
  <div id="roomPortalModal" class="room-modal">
    <div class="room-modal-backdrop" onclick="closeRoomPortalModal()"></div>
    <div class="room-modal-content" style="max-width:720px;">
      <button type="button" class="room-modal-close" onclick="closeRoomPortalModal()">‚úï</button>
      <div class="room-modal-title" id="portalRoomHeader">T√†i kho·∫£n ph√≤ng</div>
      <div class="room-modal-subtitle">
        Ch·ªß ph√≤ng: <span id="portalPhone"></span>
      </div>

      <!-- Ho√° ƒë∆°n h√†ng th√°ng -->
      <div class="portal-section">
        <h4>Ho√° ƒë∆°n h√†ng th√°ng</h4>
        <div id="portalInvoices" class="portal-list">
          ƒêang t·∫£i d·ªØ li·ªáu ho√° ƒë∆°n...
        </div>
      </div>

      <!-- H·ª£p ƒë·ªìng ƒë√£ k√Ω -->
      <div class="portal-section">
        <h4>H·ª£p ƒë·ªìng ƒë√£ k√Ω</h4>
        <div id="portalContract" class="portal-list">
          ƒêang t·∫£i th√¥ng tin h·ª£p ƒë·ªìng...
        </div>
      </div>

      <!-- ƒêƒÉng k√Ω t·∫°m tr√∫ -->
      <div class="portal-section">
        <h4>ƒêƒÉng k√Ω t·∫°m tr√∫</h4>
        <div id="portalTamTru" class="portal-list">
          ƒêang t·∫£i danh s√°ch ƒëƒÉng k√Ω t·∫°m tr√∫...
        </div>
      </div>

      <!-- B√°o h·ªèng -->
      <div class="portal-section">
        <h4>B√°o h·ªèng</h4>
        <div id="portalBaoHong" class="portal-list">
          ƒêang t·∫£i l·ªãch s·ª≠ b√°o h·ªèng...
        </div>
      </div>
    </div>
  </div>

  
  <!-- MODAL VIDEO -->
  <div id="videoModal" class="video-modal">
    <div class="video-modal-backdrop" onclick="closeVideoModal()"></div>
    <div class="video-modal-content">
      <button type="button" class="video-modal-close" onclick="closeVideoModal()">‚úï</button>
      <div id="videoContainer"></div>
    </div>
  </div>

  <!-- MODAL ƒêƒÇNG NH·∫¨P T√ÄI KHO·∫¢N PH√íNG -->
  <div id="authModal" class="auth-modal">
    <div class="auth-modal-backdrop" onclick="closeLoginModal()"></div>
    <div class="auth-modal-card">
      <button class="auth-modal-close" type="button" onclick="closeLoginModal()">‚úï</button>
      <div class="auth-title">ƒêƒÉng nh·∫≠p t√†i kho·∫£n ph√≤ng</div>
      <div class="auth-subtitle">
        Nh·∫≠p <strong>m√£ ph√≤ng</strong> (v√≠ d·ª•: 301, 4A, CƒÉn h·ªô 2PN...) v√† s·ªë ƒëi·ªán tho·∫°i ƒë√£ ƒëƒÉng k√Ω h·ª£p ƒë·ªìng.
      </div>
      <form id="tenantLoginForm">
        <div class="form-group">
          <label for="loginRoomCode">M√£ ph√≤ng</label>
          <input id="loginRoomCode" class="form-control" type="text" required
                 placeholder="V√≠ d·ª•: 301, 4A, CH-502..." />
        </div>
        <div class="form-group">
          <label for="loginPhone">S·ªë ƒëi·ªán tho·∫°i ng∆∞·ªùi thu√™</label>
          <input id="loginPhone" class="form-control" type="tel" required
                 placeholder="S·ªë ƒëi·ªán tho·∫°i tr√™n h·ª£p ƒë·ªìng" />
        </div>
        <button type="submit" class="btn" style="width:100%; justify-content:center;">
          ƒêƒÉng nh·∫≠p
        </button>
        <p id="tenantLoginStatus"></p>
      </form>
    </div>
  </div>

  <script>
    // üëâ D√ÅN URL WEB APP API C·ª¶A B·∫†N ·ªû ƒê√ÇY
    const API_URL = "https://script.google.com/macros/s/AKfycbz9W2kZsevLSMlvvVwn4u0S5k3xT1Ncs0MEp4Sxpv__30Pb6sLMWlW1rKnG9Cweqnczfw/exec";

    let ALL_ROOMS = [];
    let CONTACT_INFO = { zalo: "", email: "", messenger: "" };

    // L∆∞u like & rating theo t·ª´ng ph√≤ng trong localStorage
    const LIKE_STORAGE_KEY = "ytHomeRoomLikes";
    const RATING_STORAGE_KEY = "ytHomeRoomRatings";

    let ROOM_LIKES = {};
    let ROOM_RATINGS = {};
    let CURRENT_FILTER = "all";

    // ====== L∆ØU TH√îNG TIN ƒêƒÇNG NH·∫¨P T√ÄI KHO·∫¢N PH√íNG ======
    const TENANT_STORAGE_KEY = "ytHomeTenant";
    let CURRENT_TENANT = null;

    function loadTenantFromStorage() {
      try {
        const raw = localStorage.getItem(TENANT_STORAGE_KEY);
        CURRENT_TENANT = raw ? JSON.parse(raw) : null;
      } catch (e) {
        CURRENT_TENANT = null;
      }
    }

    function saveTenantToStorage() {
      try {
        if (CURRENT_TENANT) {
          localStorage.setItem(TENANT_STORAGE_KEY, JSON.stringify(CURRENT_TENANT));
        } else {
          localStorage.removeItem(TENANT_STORAGE_KEY);
        }
      } catch (e) {
        console.error("saveTenantToStorage error:", e);
      }
    }

    function logoutTenant() {
      CURRENT_TENANT = null;
      saveTenantToStorage();
      updateTenantUI();
      alert("ƒê√£ ƒëƒÉng xu·∫•t t√†i kho·∫£n ph√≤ng.");
    }

    function openLoginModal() {
      const modal = document.getElementById("authModal");
      const status = document.getElementById("tenantLoginStatus");
      if (status) status.textContent = "";
      const form = document.getElementById("tenantLoginForm");
      if (form) form.reset();
      if (modal) modal.classList.add("show");
    }

    function closeLoginModal() {
      const modal = document.getElementById("authModal");
      if (modal) modal.classList.remove("show");
    }

    function updateTenantUI() {
      const portal = document.getElementById("tenantPortal");
      const nameEl = document.getElementById("tenantWelcomeName");
      const roomEl = document.getElementById("tenantWelcomeRoom");
      const loginBtnLabel = document.getElementById("tenantLoginBtnLabel");

      if (!portal || !loginBtnLabel) return;

      if (CURRENT_TENANT && CURRENT_TENANT.roomCode) {
        portal.style.display = "block";
        loginBtnLabel.textContent =
          "Ph√≤ng " + (CURRENT_TENANT.roomCode || CURRENT_TENANT.maPhong || "");
        if (nameEl) {
          nameEl.textContent =
            CURRENT_TENANT.tenantName ||
            CURRENT_TENANT.tenNguoiThue ||
            "C∆∞ d√¢n";
        }
        if (roomEl) {
          roomEl.textContent = CURRENT_TENANT.roomCode || CURRENT_TENANT.maPhong || "";
        }
        loadTenantDashboard();
      } else {
        portal.style.display = "none";
        loginBtnLabel.textContent = "T√†i kho·∫£n ph√≤ng";
      }
    }

    // ƒêƒÉng nh·∫≠p t√†i kho·∫£n ph√≤ng
    async function handleTenantLogin(event) {
      event.preventDefault();
      const roomCode = document.getElementById("loginRoomCode").value.trim();
      const phone = document.getElementById("loginPhone").value.trim();
      const statusEl = document.getElementById("tenantLoginStatus");
      if (!roomCode || !phone) {
        if (statusEl) statusEl.textContent = "Vui l√≤ng nh·∫≠p ƒë·ªß m√£ ph√≤ng v√† s·ªë ƒëi·ªán tho·∫°i.";
        return;
      }

      if (statusEl) statusEl.textContent = "ƒêang ki·ªÉm tra th√¥ng tin ƒëƒÉng nh·∫≠p...";

      try {
        // üëâ Backend Apps Script: x·ª≠ l√Ω action=tenantLogin
        // Tr·∫£ v·ªÅ: { success, message, roomCode, tenantName, maPhong, tenNguoiThue, ... }
        const body = new URLSearchParams({
          action: "tenantLogin",
          roomCode: roomCode,
          phone: phone
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
          },
          body
        });

        const data = await res.json();
        if (!data || !data.success) {
          if (statusEl) {
            statusEl.textContent =
              (data && data.message) || "Kh√¥ng t√¨m th·∫•y ph√≤ng ho·∫∑c s·ªë ƒëi·ªán tho·∫°i kh√¥ng kh·ªõp.";
          }
          return;
        }

        CURRENT_TENANT = {
          roomCode: data.roomCode || roomCode,
          tenantName: data.tenantName || data.tenNguoiThue || "",
          maPhong: data.maPhong || roomCode
        };
        saveTenantToStorage();
        if (statusEl) statusEl.textContent = "ƒêƒÉng nh·∫≠p th√†nh c√¥ng.";
        closeLoginModal();
        updateTenantUI();
        scrollToSection("tenantPortal");
      } catch (e) {
        console.error("handleTenantLogin error:", e);
        if (statusEl) {
          statusEl.textContent = "C√≥ l·ªói khi ƒëƒÉng nh·∫≠p. Vui l√≤ng th·ª≠ l·∫°i sau.";
        }
      }
    }

    // Tabs trong portal
    function initTenantTabs() {
      const tabs = document.querySelectorAll(".tenant-tab");
      const panels = document.querySelectorAll(".tenant-panel");
      tabs.forEach((tab) => {
        tab.addEventListener("click", () => {
          const target = tab.dataset.tab;
          tabs.forEach((t) => t.classList.remove("active"));
          panels.forEach((p) => p.classList.remove("active"));
          tab.classList.add("active");
          const panel = document.getElementById(target);
          if (panel) panel.classList.add("active");
        });
      });
    }

    // Render h√≥a ƒë∆°n
    function renderTenantBills(invoices) {
      const tbody = document.querySelector("#tenantBillsTable tbody");
      const statusEl = document.getElementById("tenantBillsStatus");
      if (!tbody) return;
      tbody.innerHTML = "";

      if (!invoices || !invoices.length) {
        if (statusEl) statusEl.textContent = "Ch∆∞a c√≥ h√≥a ƒë∆°n tr√™n h·ªá th·ªëng.";
        return;
      }

      if (statusEl) statusEl.textContent = "C√≥ " + invoices.length + " h√≥a ƒë∆°n.";

      invoices.forEach((inv) => {
        const tr = document.createElement("tr");
        const monthText =
          inv.monthYear ||
          inv.thangNam ||
          (inv.month && inv.year ? inv.month + "/" + inv.year : "");
        const totalText = formatVND(inv.total || inv.tongTien || inv.tienThanhToan || 0);
        const statusText = inv.status || inv.trangThai || inv.tinhTrang || "";
        const dueText = inv.dueDate || inv.hanThanhToan || "";

        const detailLink = inv.detailUrl || inv.link || "";
        const detailHtml = detailLink
          ? `<a href="${detailLink}" target="_blank" rel="noopener noreferrer">Xem</a>`
          : "";

        tr.innerHTML = `
          <td>${monthText || ""}</td>
          <td>${totalText}</td>
          <td>${statusText}</td>
          <td>${dueText}</td>
          <td>${detailHtml}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Render l·ªãch s·ª≠ y√™u c·∫ßu
    function renderTenantHistory(items) {
      const list = document.getElementById("tenantHistoryList");
      const statusEl = document.getElementById("tenantHistoryStatus");
      if (!list) return;
      list.innerHTML = "";

      if (!items || !items.length) {
        if (statusEl) statusEl.textContent = "Ch∆∞a c√≥ y√™u c·∫ßu n√†o ƒë∆∞·ª£c ghi nh·∫≠n.";
        return;
      }

      if (statusEl) statusEl.textContent = "T·ªïng " + items.length + " y√™u c·∫ßu.";

      items.forEach((it) => {
        const div = document.createElement("div");
        div.className = "tenant-history-item";

        const typeText = it.type || it.loai || "";
        const dateText = it.createdAt || it.ngay || "";
        const statusText = it.status || it.trangThai || "";
        const contentText = it.content || it.noiDung || it.moTa || "";

        div.innerHTML = `
          <div style="margin-bottom:2px;">
            <span class="tenant-badge">${typeText}</span>
            <span style="font-size:0.76rem; color:rgba(148,163,184,0.95);">${dateText}</span>
          </div>
          <div style="margin-bottom:2px;">
            ${contentText}
          </div>
          <div style="font-size:0.76rem; color:rgba(148,163,184,0.96);">
            Tr·∫°ng th√°i: <strong>${statusText}</strong>
          </div>
        `;
        list.appendChild(div);
      });
    }

    // T·∫£i dashboard cho t√†i kho·∫£n ph√≤ng
    async function loadTenantDashboard() {
      if (!CURRENT_TENANT || !CURRENT_TENANT.roomCode) return;
      const roomCode = CURRENT_TENANT.roomCode;
      const billsStatus = document.getElementById("tenantBillsStatus");
      const historyStatus = document.getElementById("tenantHistoryStatus");

      if (billsStatus) billsStatus.textContent = "ƒêang t·∫£i h√≥a ƒë∆°n...";
      if (historyStatus) historyStatus.textContent = "ƒêang t·∫£i d·ªØ li·ªáu...";

      try {
        // üëâ Backend Apps Script: x·ª≠ l√Ω action=tenantDashboard&roomCode=...
        // Tr·∫£ v·ªÅ: { success, invoices: [...], history: [...] }
        const res = await fetch(
          API_URL + "?action=tenantDashboard&roomCode=" + encodeURIComponent(roomCode)
        );
        const data = await res.json();
        if (!data || !data.success) {
          if (billsStatus) billsStatus.textContent = "Kh√¥ng t·∫£i ƒë∆∞·ª£c d·ªØ li·ªáu h√≥a ƒë∆°n.";
          if (historyStatus) historyStatus.textContent = "Kh√¥ng t·∫£i ƒë∆∞·ª£c l·ªãch s·ª≠ y√™u c·∫ßu.";
          return;
        }
        renderTenantBills(data.invoices || []);
        renderTenantHistory(data.history || []);
      } catch (e) {
        console.error("loadTenantDashboard error:", e);
        if (billsStatus) billsStatus.textContent = "L·ªói k·∫øt n·ªëi khi t·∫£i h√≥a ƒë∆°n.";
        if (historyStatus) historyStatus.textContent = "L·ªói k·∫øt n·ªëi khi t·∫£i l·ªãch s·ª≠ y√™u c·∫ßu.";
      }
    }

    // G·ª≠i b√°o h·ªèng
    async function handleMaintenanceSubmit(event) {
      event.preventDefault();
      if (!CURRENT_TENANT || !CURRENT_TENANT.roomCode) {
        alert("Vui l√≤ng ƒëƒÉng nh·∫≠p t√†i kho·∫£n ph√≤ng tr∆∞·ªõc khi b√°o h·ªèng.");
        openLoginModal();
        return;
      }
      const category = document.getElementById("maintenanceCategory").value.trim();
      const desc = document.getElementById("maintenanceDesc").value.trim();
      const time = document.getElementById("maintenanceTime").value.trim();
      const statusEl = document.getElementById("maintenanceStatus");

      if (statusEl) statusEl.textContent = "ƒêang g·ª≠i y√™u c·∫ßu...";

      try {
        // üëâ Backend Apps Script: action=tenantMaintenance
        const body = new URLSearchParams({
          action: "tenantMaintenance",
          roomCode: CURRENT_TENANT.roomCode,
          category,
          description: desc,
          preferredTime: time
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
          },
          body
        });

        const data = await res.json();
        if (!data || !data.success) {
          if (statusEl) statusEl.textContent =
            (data && data.message) || "Kh√¥ng g·ª≠i ƒë∆∞·ª£c y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i.";
          return;
        }

        if (statusEl) statusEl.textContent = "ƒê√£ g·ª≠i y√™u c·∫ßu s·ª≠a ch·ªØa. C·∫£m ∆°n b·∫°n.";
        document.getElementById("maintenanceForm").reset();
        loadTenantDashboard(); // c·∫≠p nh·∫≠t l·ªãch s·ª≠
      } catch (e) {
        console.error("handleMaintenanceSubmit error:", e);
        if (statusEl) statusEl.textContent = "C√≥ l·ªói khi g·ª≠i y√™u c·∫ßu. Vui l√≤ng th·ª≠ l·∫°i.";
      }
    }

    // G·ª≠i ƒëƒÉng k√Ω t·∫°m tr√∫
    async function handleTempStaySubmit(event) {
      event.preventDefault();
      if (!CURRENT_TENANT || !CURRENT_TENANT.roomCode) {
        alert("Vui l√≤ng ƒëƒÉng nh·∫≠p t√†i kho·∫£n ph√≤ng tr∆∞·ªõc khi ƒëƒÉng k√Ω t·∫°m tr√∫.");
        openLoginModal();
        return;
      }

      const guestName = document.getElementById("tempGuestName").value.trim();
      const guestId = document.getElementById("tempGuestId").value.trim();
      const stayFrom = document.getElementById("tempStayFrom").value.trim();
      const note = document.getElementById("tempStayNote").value.trim();
      const statusEl = document.getElementById("tempStayStatus");

      if (statusEl) statusEl.textContent = "ƒêang g·ª≠i ƒëƒÉng k√Ω...";

      try {
        // üëâ Backend Apps Script: action=tenantTempStay
        const body = new URLSearchParams({
          action: "tenantTempStay",
          roomCode: CURRENT_TENANT.roomCode,
          guestName,
          guestId,
          stayTime: stayFrom,
          note
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
          },
          body
        });

        const data = await res.json();
        if (!data || !data.success) {
          if (statusEl) statusEl.textContent =
            (data && data.message) || "Kh√¥ng g·ª≠i ƒë∆∞·ª£c ƒëƒÉng k√Ω. Vui l√≤ng th·ª≠ l·∫°i.";
          return;
        }

        if (statusEl) statusEl.textContent = "ƒê√£ g·ª≠i ƒëƒÉng k√Ω t·∫°m tr√∫. C·∫£m ∆°n b·∫°n.";
        document.getElementById("tempStayForm").reset();
        loadTenantDashboard(); // c·∫≠p nh·∫≠t l·ªãch s·ª≠
      } catch (e) {
        console.error("handleTempStaySubmit error:", e);
        if (statusEl) statusEl.textContent = "C√≥ l·ªói khi g·ª≠i ƒëƒÉng k√Ω. Vui l√≤ng th·ª≠ l·∫°i.";
      }
    }

    // ====== PH·∫¶N LIKE / RATING / PH√íNG (gi·ªØ nguy√™n g·ªëc) ======
    function loadLikesFromStorage() {
      try {
        const raw = localStorage.getItem(LIKE_STORAGE_KEY);
        ROOM_LIKES = raw ? JSON.parse(raw) : {};
      } catch (e) {
        ROOM_LIKES = {};
      }
    }

    function saveLikesToStorage() {
      try {
        localStorage.setItem(LIKE_STORAGE_KEY, JSON.stringify(ROOM_LIKES));
      } catch (e) {
        console.error("saveLikesToStorage error:", e);
      }
    }

    function toggleLike(roomId) {
      if (!roomId) return;
      const current = ROOM_LIKES[roomId] || { count: 0, liked: false };
      if (current.liked) {
        current.liked = false;
        current.count = Math.max(0, current.count - 1);
      } else {
        current.liked = true;
        current.count = (current.count || 0) + 1;
      }
      ROOM_LIKES[roomId] = current;
      saveLikesToStorage();
      renderRooms();
      renderHeroOverview();
    }

    function copyRoomLink(encodedRoomId) {
      const id = decodeURIComponent(encodedRoomId || "");
      if (!id) return;
      const base = window.location.origin + window.location.pathname.replace(/index\.html$/i, "");
      const url = base + "room.html?room=" + encodeURIComponent(id);

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(url)
          .then(() => {
            alert("ƒê√£ sao ch√©p link ph√≤ng " + id + " v√†o clipboard.");
          })
          .catch(() => {
            prompt("Kh√¥ng th·ªÉ t·ª± ƒë·ªông sao ch√©p, b·∫°n copy link th·ªß c√¥ng nh√©:", url);
          });
      } else {
        prompt("Kh√¥ng th·ªÉ t·ª± ƒë·ªông sao ch√©p, b·∫°n copy link th·ªß c√¥ng nh√©:", url);
      }
    }

    function formatVND(amount) {
      if (amount === null || amount === undefined || amount === "") return "--";
      const num = Number(String(amount).replace(/[^\d.-]/g, ""));
      if (isNaN(num)) return String(amount);
      return num.toLocaleString("vi-VN") + " ƒë";
    }

    function scrollToSection(id) {
      const el = document.getElementById(id);
      if (el) {
        el.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function buildVideoEmbed(url) {
      if (!url) return "";
      const u = String(url).trim();

      if (u.includes("youtube.com") || u.includes("youtu.be")) {
        let videoId = "";
        const shortMatch = u.match(/youtu\.be\/([^?&]+)/);
        if (shortMatch) videoId = shortMatch[1];
        const longMatch = u.match(/[?&]v=([^&]+)/);
        if (longMatch) videoId = longMatch[1] || videoId;

        if (!videoId) {
          return `<iframe src="${u}" allowfullscreen></iframe>`;
        }
        const embedUrl = "https://www.youtube.com/embed/" + videoId;
        return `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
      }

      return `
        <video controls playsinline>
          <source src="${u}">
          Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ph√°t video.
        </video>
      `;
    }

    function openVideoModal(encodedUrl) {
      const url = decodeURIComponent(encodedUrl || "");
      if (!url) {
        alert("Ch∆∞a c√≥ video cho ph√≤ng n√†y.");
        return;
      }
      const modal = document.getElementById("videoModal");
      const container = document.getElementById("videoContainer");
      container.innerHTML = buildVideoEmbed(url);
      modal.classList.add("show");
    }

    function closeVideoModal() {
      const modal = document.getElementById("videoModal");
      const container = document.getElementById("videoContainer");
      container.innerHTML = "";
      modal.classList.remove("show");
    }

    // ====== H√ÄM PH·ª§ CHO L·ªåC / S·∫ÆP X·∫æP & T·ªîNG QUAN ======
    function getFloorNumber(room) {
      const raw = (room.tang || "").toString().toLowerCase();
      if (!raw) return 999; // ƒë∆∞a xu·ªëng cu·ªëi
      if (raw.includes("tr·ªát") || raw.includes("tret") || raw.includes("ground")) return 0;
      const m = raw.match(/(\d+)/);
      if (m) {
        const n = parseInt(m[1], 10);
        if (!isNaN(n)) return n;
      }
      return 999;
    }

    function getRoomPriceNumber(room) {
      const raw = room.giaThue;
      if (raw === null || raw === undefined || raw === "") return null;
      const num = Number(String(raw).replace(/[^\d.-]/g, ""));
      return isNaN(num) ? null : num;
    }

    function getRoomAreaNumber(room) {
      const raw = room.dienTich || room.dientich;
      if (!raw) return null;
      const num = Number(String(raw).replace(/[^\d.-]/g, ""));
      return isNaN(num) ? null : num;
    }

    function isRoomLiked(room) {
      const id = room.maPhong || "";
      const data = ROOM_LIKES[id];
      return !!(data && data.liked);
    }

    function matchesFloor(room, value) {
      if (value === "all") return true;
      const n = getFloorNumber(room);
      const v = parseInt(value, 10);
      if (isNaN(v) || n === 999) return false;
      return n === v;
    }

    function matchesRating(room, value) {
      if (value === "all") return true;
      const avg = Number(room.ratingAvg || 0);
      if (value === "rated") return avg > 0;
      if (value === "3plus") return avg >= 3;
      if (value === "4plus") return avg >= 4;
      return true;
    }

    function matchesInterest(room, value) {
      if (value === "all") return true;
      if (value === "liked") return isRoomLiked(room);
      return true;
    }

    function matchesPrice(room, value) {
      if (value === "all") return true;
      const p = getRoomPriceNumber(room);
      if (p == null) return true; // kh√¥ng c√≥ gi√° th√¨ kh√¥ng l·ªçc
      if (value === "lt3") return p < 3000000;
      if (value === "3-35") return p >= 3000000 && p <= 3500000;
      if (value === "35-4") return p > 3500000 && p <= 4000000;
      if (value === "gt4") return p > 4000000;
      return true;
    }

    function matchesArea(room, value) {
      if (value === "all") return true;
      const a = getRoomAreaNumber(room);
      if (a == null) return true;
      if (value === "lt18") return a < 18;
      if (value === "18-25") return a >= 18 && a <= 25;
      if (value === "gt25") return a > 25;
      return true;
    }

    function sortRooms(a, b) {
      // s·∫Øp theo t·∫ßng, r·ªìi theo m√£ ph√≤ng
      const fa = getFloorNumber(a);
      const fb = getFloorNumber(b);
      if (fa !== fb) return fa - fb;

      const idA = (a.maPhong || "").toString();
      const idB = (b.maPhong || "").toString();
      return idA.localeCompare(idB, "vi", { numeric: true, sensitivity: "base" });
    }

    // ====== T·ªîNG QUAN T√íA NH√Ä (BI·ªÇU ƒê·ªí B√äN PH·∫¢I HERO) ======
    function renderHeroOverview() {
      const box = document.getElementById("heroOverview");
      if (!box) return;

      if (!ALL_ROOMS.length) {
        box.innerHTML = `
          <div class="hero-chart-row">
            <div class="hero-chart-top">
              <span class="hero-chart-label">D·ªØ li·ªáu ph√≤ng</span>
              <span class="hero-chart-value">Ch∆∞a c√≥ tr√™n h·ªá th·ªëng</span>
            </div>
          </div>
        `;
        return;
      }

      const total = ALL_ROOMS.length;
      const availableRooms = ALL_ROOMS.filter((r) => r.trangThaiWebsite === "available");
      const likedRooms = ALL_ROOMS.filter((r) => isRoomLiked(r));
      const highRatedRooms = ALL_ROOMS.filter(
        (r) => Number(r.ratingAvg || 0) >= 4 && Number(r.ratingCount || 0) > 0
      );

      function pct(count) {
        if (!total) return 0;
        return Math.max(4, Math.min(100, Math.round((count / total) * 100)));
      }

      box.innerHTML = `
        <div class="hero-chart-row">
          <div class="hero-chart-top">
            <span class="hero-chart-label">C√≤n tr·ªëng</span>
            <span class="hero-chart-value">${availableRooms.length}/${total} ph√≤ng</span>
          </div>
          <div class="hero-chart-bar-bg">
            <div class="hero-chart-bar-fill hero-chart-bar-available" style="width:${pct(
              availableRooms.length
            )}%"></div>
          </div>
        </div>
        <div class="hero-chart-row">
          <div class="hero-chart-top">
            <span class="hero-chart-label">ƒê∆∞·ª£c b·∫°n quan t√¢m (‚ô•)</span>
            <span class="hero-chart-value">${likedRooms.length}/${total} ph√≤ng</span>
          </div>
          <div class="hero-chart-bar-bg">
            <div class="hero-chart-bar-fill hero-chart-bar-liked" style="width:${pct(
              likedRooms.length
            )}%"></div>
          </div>
        </div>
        <div class="hero-chart-row">
          <div class="hero-chart-top">
            <span class="hero-chart-label">ƒê√°nh gi√° t·ª´ 4‚òÖ tr·ªü l√™n</span>
            <span class="hero-chart-value">${highRatedRooms.length}/${total} ph√≤ng</span>
          </div>
          <div class="hero-chart-bar-bg">
            <div class="hero-chart-bar-fill hero-chart-bar-highrated" style="width:${pct(
              highRatedRooms.length
            )}%"></div>
          </div>
        </div>
      `;
    }

    // ====== RENDER DANH S√ÅCH PH√íNG ======
    function renderRooms(filter) {
      const grid = document.getElementById("roomsGrid");
      const statusEl = document.getElementById("roomsStatus");
      grid.innerHTML = "";

      if (typeof filter === "string") {
        CURRENT_FILTER = filter;
      } else {
        filter = CURRENT_FILTER;
      }

      // ƒë·ªçc c√°c filter n√¢ng cao
      const floorVal =
        (document.getElementById("filterFloor") &&
          document.getElementById("filterFloor").value) ||
        "all";
      const ratingVal =
        (document.getElementById("filterRating") &&
          document.getElementById("filterRating").value) ||
        "all";
      const interestVal =
        (document.getElementById("filterInterest") &&
          document.getElementById("filterInterest").value) ||
        "all";
      const priceVal =
        (document.getElementById("filterPrice") &&
          document.getElementById("filterPrice").value) ||
        "all";
      const areaVal =
        (document.getElementById("filterArea") &&
          document.getElementById("filterArea").value) ||
        "all";

      let filtered = ALL_ROOMS.filter((room) => {
        if (filter === "all") return true;
        if (filter === "available") return room.trangThaiWebsite === "available";
        return room.loaiPhong === filter;
      });

      filtered = filtered
        .filter((room) => matchesFloor(room, floorVal))
        .filter((room) => matchesRating(room, ratingVal))
        .filter((room) => matchesInterest(room, interestVal))
        .filter((room) => matchesPrice(room, priceVal))
        .filter((room) => matchesArea(room, areaVal))
        .sort(sortRooms);

      statusEl.textContent = filtered.length
        ? "Hi·ªÉn th·ªã " + filtered.length + " ph√≤ng."
        : "Kh√¥ng c√≥ ph√≤ng ph√π h·ª£p v·ªõi b·ªô l·ªçc hi·ªán t·∫°i.";

      filtered.forEach((room) => {
         const detailUrl = `room.html?room=${detailIdEncoded}`;
         const starsHtml = buildStarsHtml(room);

        const videoIconHtml = room.video
        ? `<button class="icon-btn" title="Xem video"
             onclick="openVideoModal('${encodeURIComponent(room.video)}')">‚ñ∂</button>`
        : "";

        card.innerHTML = `
        <!-- D√≤ng 1: t√™n ph√≤ng + tr·∫°ng th√°i -->
        <div class="room-line">
          <div>
            ${roomId || ""}${room.loaiPhong ? " ¬∑ " + room.loaiPhong : ""}
          </div>
          <span class="room-status-chip ${statusClass}">
            ${statusText}
          </span>
        </div>

        <!-- D√≤ng 2: T·∫ßng -->
        <div class="room-line">
          <span>${room.tang ? "T·∫ßng " + room.tang : ""}</span>
        </div>

        <!-- D√≤ng 3: gi√° thu√™ -->
        <div class="room-line">
          <span>
            ${room.giaThue ? formatVND(room.giaThue) + " /th√°ng" : "-/th√°ng"}
          </span>
        </div>

        <!-- D√≤ng 4: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê + s·ªë l∆∞·ª£t ƒë√°nh gi√° -->
        <div class="room-line">
          ${starsHtml}
        </div>

        <!-- Footer: like / link / xem / ƒëƒÉng nh·∫≠p -->
        <div class="room-footer">
          <div class="room-actions">
            <button class="icon-btn${likeBtnExtraClass}"
              onclick="toggleLike('${roomId}')">‚ô•</button>
            <button class="icon-btn"
              onclick="copyRoomLink('${detailIdEncoded}')">üîó</button>
            ${videoIconHtml || ""}
            <span class="like-count">${likeData.count || 0}</span>
          </div>
          <div style="display:flex;gap:4px;">
            <a class="room-btn" href="${detailUrl}">Xem chi ti·∫øt</a>
            <button type="button"
                    class="room-btn-secondary"
                    onclick="openRoomLoginModal('${roomId}')">
              ƒêƒÉng nh·∫≠p
            </button>
          </div>
          </div>
        `;


        card.innerHTML = `
          <!-- D√≤ng 1: t√™n ph√≤ng + tr·∫°ng th√°i -->
          <div class="room-line">
            <div>
              ${roomId || ""}${room.loaiPhong ? " ¬∑ " + room.loaiPhong : ""}
            </div>
            <span class="room-status-chip ${statusClass}">
              ${statusText}
            </span>
          </div>

          <!-- D√≤ng 2: T·∫ßng -->
          <div class="room-line">
            <span>${room.tang ? "T·∫ßng " + room.tang : ""}</span>
          </div>

          <!-- D√≤ng 3: gi√° thu√™ -->
          <div class="room-line">
            <span>
              ${room.giaThue ? formatVND(room.giaThue) + " /th√°ng" : "-/th√°ng"}
            </span>
          </div>

          <!-- D√≤ng 4: ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê + s·ªë l∆∞·ª£t ƒë√°nh gi√° -->
          <div class="room-line">
            ${starsHtml}
          </div>

          <!-- Footer: like / link / xem -->
          <div class="room-footer">
            <div class="room-actions">
              <button class="icon-btn${likeBtnExtraClass}"
                onclick="toggleLike('${roomId}')">‚ô•</button>
              <button class="icon-btn"
                onclick="copyRoomLink('${detailIdEncoded}')">üîó</button>
              ${videoIconHtml || ""}
              <span class="like-count">${likeData.count || 0}</span>
            </div>
            <a class="room-btn" href="${detailUrl}">Xem chi ti·∫øt</a>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    function updateStats() {
      const totalRoomsEl = document.getElementById("statTotalRooms");
      const availableEl = document.getElementById("statAvailable");
      const heroStatus = document.getElementById("heroStatus");

      const total = ALL_ROOMS.length;
      const availableCount = ALL_ROOMS.filter(
        (r) => r.trangThaiWebsite === "available"
      ).length;

      totalRoomsEl.textContent = total || "--";
      availableEl.textContent = availableCount + " ph√≤ng tr·ªëng";
      heroStatus.textContent = availableCount > 0 ? "C√≤n ph√≤ng tr·ªëng" : "T·∫°m h·∫øt ph√≤ng";
    }

    function initFilters() {
      // filter theo lo·∫°i ph√≤ng / c√≤n tr·ªëng
      document.querySelectorAll(".filter-pill").forEach((btn) => {
        btn.addEventListener("click", () => {
          document
            .querySelectorAll(".filter-pill")
            .forEach((b) => b.classList.remove("active"));
          btn.classList.add("active");

          const filter = btn.dataset.filter;
          renderRooms(filter);
        });
      });

      // filter n√¢ng cao
      ["filterFloor", "filterRating", "filterInterest", "filterPrice", "filterArea"].forEach(
        (id) => {
          const el = document.getElementById(id);
          if (el) {
            el.addEventListener("change", () => {
              renderRooms(); // gi·ªØ CURRENT_FILTER
            });
          }
        }
      );
    }

    async function loadRoomsFromServer() {
      const statusEl = document.getElementById("roomsStatus");
      statusEl.textContent = "ƒêang t·∫£i d·ªØ li·ªáu ph√≤ng t·ª´ server...";

      try {
        const res = await fetch(API_URL + "?action=rooms");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        ALL_ROOMS = (data && data.rooms) || [];

        statusEl.textContent = ALL_ROOMS.length
          ? "ƒê√£ t·∫£i " + ALL_ROOMS.length + " ph√≤ng t·ª´ h·ªá th·ªëng."
          : 'Ch∆∞a c√≥ d·ªØ li·ªáu ph√≤ng trong sheet "Ph√≤ng".';

        renderRooms("all");
        renderHeroOverview();
        updateStats();
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "L·ªói khi t·∫£i d·ªØ li·ªáu ph√≤ng. Vui l√≤ng ki·ªÉm tra API_URL ho·∫∑c Apps Script.";
      }
    }

    async function handleSubmit(event) {
      event.preventDefault();
      const formStatus = document.getElementById("formStatus");
      formStatus.textContent = "ƒêang g·ª≠i...";

      const formData = {
        name: document.getElementById("name").value.trim(),
        phone: document.getElementById("phone").value.trim(),
        roomType: document.getElementById("roomType").value,
        message: document.getElementById("message").value.trim()
      };

      try {
        const body = new URLSearchParams({
          action: "contact",
          name: formData.name,
          phone: formData.phone,
          roomType: formData.roomType,
          message: formData.message
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
          },
          body
        });

        const data = await res.json();
        formStatus.textContent =
          (data && data.message) ||
          "G·ª≠i th√†nh c√¥ng. C·∫£m ∆°n b·∫°n ƒë√£ li√™n h·ªá YT Home.";
        document.getElementById("contactForm").reset();
      } catch (err) {
        console.error(err);
        formStatus.textContent =
          "C√≥ l·ªói khi g·ª≠i th√¥ng tin. Vui l√≤ng th·ª≠ l·∫°i sau.";
      }
    }

    async function loadContactInfo() {
      try {
        const res = await fetch(API_URL + "?action=contactInfo");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        CONTACT_INFO = (data && data.contact) || CONTACT_INFO;

        const phoneSpan = document.getElementById("contactPhoneText");
        const emailSpan = document.getElementById("contactEmailText");
        const zaloLink  = document.getElementById("zaloQuickLink");
        const mailLink  = document.getElementById("emailQuickLink");
        const msgLink   = document.getElementById("messengerQuickLink");

        if (emailSpan && CONTACT_INFO.email) {
          emailSpan.textContent = CONTACT_INFO.email;
        }
        if (phoneSpan && CONTACT_INFO.zalo) {
          phoneSpan.textContent = CONTACT_INFO.zalo;
        }

        if (zaloLink && CONTACT_INFO.zalo) {
          zaloLink.href = CONTACT_INFO.zalo;
        }
        if (mailLink && CONTACT_INFO.email) {
          const subject = encodeURIComponent("YT Home - T∆∞ v·∫•n thu√™ ph√≤ng");
          mailLink.href = `mailto:${CONTACT_INFO.email}?subject=${subject}`;
        }
        if (msgLink && CONTACT_INFO.messenger) {
          msgLink.href = CONTACT_INFO.messenger;
        }
      } catch (err) {
        console.error("loadContactInfo error:", err);
      }
    }

    function loadRatingsFromStorage() {
      try {
        const raw = localStorage.getItem(RATING_STORAGE_KEY);
        ROOM_RATINGS = raw ? JSON.parse(raw) : {};
      } catch (e) {
        ROOM_RATINGS = {};
      }
    }

    function saveRatingsToStorage() {
      try {
        localStorage.setItem(RATING_STORAGE_KEY, JSON.stringify(ROOM_RATINGS));
      } catch (e) {
        console.error("saveRatingsToStorage error:", e);
      }
    }

    function getRoomRating(roomId) {
      if (!roomId) return 0;
      const data = ROOM_RATINGS[roomId] || { rating: 0 };
      return data.rating || 0;
    }

    // G·ª≠i ƒë√°nh gi√° l√™n Apps Script + c·∫≠p nh·∫≠t RatingAvg & RatingCount
    async function setRoomRating(roomId, rating) {
      if (!roomId) return;
      const r = Math.max(1, Math.min(5, rating)); // 1‚Äì5 sao
      const old = getRoomRating(roomId);          // rating c≈© c·ªßa user (0 n·∫øu ch∆∞a ƒë√°nh gi√°)

      try {
        const body = new URLSearchParams({
          action: "rateRoom",
          roomId: roomId,
          rating: String(r),
          oldRating: String(old || 0)
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
          },
          body
        });

        const data = await res.json();
        if (!data || !data.success) {
          alert("Kh√¥ng th·ªÉ g·ª≠i ƒë√°nh gi√°. Vui l√≤ng th·ª≠ l·∫°i sau.");
          return;
        }

        // L∆∞u rating c·ªßa ri√™ng user v√†o localStorage
        ROOM_RATINGS[roomId] = { rating: r };
        saveRatingsToStorage();

        // C·∫≠p nh·∫≠t l·∫°i RatingAvg & RatingCount trong ALL_ROOMS
        const found = ALL_ROOMS.find((rm) => (rm.maPhong || "") === roomId);
        if (found) {
          found.ratingAvg = data.ratingAvg || r;
          found.ratingCount = data.ratingCount != null ? data.ratingCount : (found.ratingCount || 0);
        }

        // Render l·∫°i danh s√°ch ph√≤ng & t·ªïng quan
        renderRooms();
        renderHeroOverview();
      } catch (e) {
        console.error("setRoomRating error:", e);
        alert("C√≥ l·ªói khi g·ª≠i ƒë√°nh gi√°. Vui l√≤ng th·ª≠ l·∫°i sau.");
      }
    }

    function buildStarsHtml(room) {
      const roomId = room.maPhong || "";
      const userRating = getRoomRating(roomId);
      const avg = Number(room.ratingAvg || 0);
      const count = Number(room.ratingCount || 0);

      let html = `<div class="rating" data-room="${roomId}">`;
      for (let i = 1; i <= 5; i++) {
        const active = i <= userRating ? "active" : "";
        html += `<span class="star ${active}" onclick="setRoomRating('${roomId}', ${i})">‚òÖ</span>`;
      }
      html += `<span class="rating-text">${avg ? avg.toFixed(1) : "--"} (${count || 0} ƒë√°nh gi√°)</span>`;
      html += "</div>";
      return html;
    }

    // ====== ƒêƒÇNG NH·∫¨P THEO M√É PH√íNG & PORTAL CHI TI·∫æT ======
    let CURRENT_LOGIN_ROOM_ID = null;

    function openRoomLoginModal(roomId) {
      CURRENT_LOGIN_ROOM_ID = roomId || "";
      const modal = document.getElementById("roomLoginModal");
      const roomInput = document.getElementById("loginRoomId");
      const phoneInput = document.getElementById("loginPhone");
      const statusEl = document.getElementById("roomLoginStatus");

      if (roomInput) roomInput.value = roomId || "";
      if (phoneInput) phoneInput.value = "";
      if (statusEl) statusEl.textContent = "";

      if (modal) modal.classList.add("show");
    }

    function closeRoomLoginModal() {
      const modal = document.getElementById("roomLoginModal");
      if (modal) modal.classList.remove("show");
    }

    function openRoomPortalModal(roomId, phone, portalData) {
      const modal = document.getElementById("roomPortalModal");
      if (!modal) return;
      renderRoomPortal(roomId, phone, portalData || {});
      modal.classList.add("show");
    }

    function closeRoomPortalModal() {
      const modal = document.getElementById("roomPortalModal");
      if (modal) modal.classList.remove("show");
    }

    // portalData (g·ª£i √Ω c·∫•u tr√∫c backend tr·∫£ v·ªÅ):
    // {
    //   contract: { soHopDong, ngayKy, ngayHetHan, trangThai },
    //   invoices: [
    //     { Th√°ng, NƒÉm, Ph·∫£iThu, TrangThai }
    //   ],
    //   tamTru: [
    //     { hoTen, tuNgay, denNgayDuKien, trangThai }
    //   ],
    //   baoHong: [
    //     { tieuDe, loaiSuCo, trangThai, createdAt }
    //   ]
    // }
    function renderRoomPortal(roomId, phone, portalData) {
      const header = document.getElementById("portalRoomHeader");
      const phoneSpan = document.getElementById("portalPhone");
      const invBox = document.getElementById("portalInvoices");
      const contractBox = document.getElementById("portalContract");
      const tamTruBox = document.getElementById("portalTamTru");
      const baoHongBox = document.getElementById("portalBaoHong");

      if (header) header.textContent = "T√†i kho·∫£n ph√≤ng " + (roomId || "");
      if (phoneSpan) phoneSpan.textContent = phone || "";

      // Ho√° ƒë∆°n
      const invoices = portalData.invoices || [];
      if (invBox) {
        if (!invoices.length) {
          invBox.textContent = "Ch∆∞a c√≥ ho√° ƒë∆°n n√†o ƒë∆∞·ª£c ghi nh·∫≠n.";
        } else {
          invBox.innerHTML = invoices
            .map((iv) => {
              const thang = iv["Th√°ng"] || iv.thang || "";
              const nam = iv["NƒÉm"] || iv.nam || "";
              const phaiThu = iv["Ph·∫£i thu"] || iv.phaiThu || iv.soTien || "";
              const trangThai = iv["Tr·∫°ng th√°i"] || iv.trangThai || "";
              return `
                <div class="portal-list-item">
                  Th√°ng ${thang}/${nam} ‚Äì Ph·∫£i thu: <strong>${formatVND(phaiThu)}</strong>
                  ${trangThai ? ` ‚Äì Tr·∫°ng th√°i: <strong>${trangThai}</strong>` : ""}
                </div>
              `;
            })
            .join("");
        }
      }

      // H·ª£p ƒë·ªìng
      const hd = portalData.contract || {};
      if (contractBox) {
        if (!Object.keys(hd).length) {
          contractBox.textContent = "Kh√¥ng t√¨m th·∫•y h·ª£p ƒë·ªìng c√≤n hi·ªáu l·ª±c.";
        } else {
          const soHD = hd.soHopDong || hd["S·ªë h·ª£p ƒë·ªìng"] || "--";
          const ngayKy = hd.ngayKy || hd["Ng√†y k√Ω"] || "--";
          const ngayHetHan = hd.ngayHetHan || hd["Ng√†y h·∫øt h·∫°n"] || "--";
          const trangThaiHD = hd.trangThai || hd["Tr·∫°ng th√°i"] || "--";

          contractBox.innerHTML = `
            <div class="portal-list-item">
              S·ªë h·ª£p ƒë·ªìng: <strong>${soHD}</strong><br/>
              Ng√†y k√Ω: <strong>${ngayKy}</strong><br/>
              Ng√†y h·∫øt h·∫°n: <strong>${ngayHetHan}</strong><br/>
              Tr·∫°ng th√°i: <strong>${trangThaiHD}</strong>
            </div>
          `;
        }
      }

      // T·∫°m tr√∫
      const tamTru = portalData.tamTru || [];
      if (tamTruBox) {
        if (!tamTru.length) {
          tamTruBox.textContent = "Ch∆∞a c√≥ ƒëƒÉng k√Ω t·∫°m tr√∫.";
        } else {
          tamTruBox.innerHTML = tamTru
            .map((tt) => {
              const ten = tt.hoTen || tt["H·ªç t√™n"] || "--";
              const tuNgay = tt.tuNgay || tt["T·ª´ ng√†y"] || "--";
              const denNgay = tt.denNgayDuKien || tt["ƒê·∫øn ng√†y d·ª± ki·∫øn"] || "--";
              const stt = tt.trangThai || tt["Tr·∫°ng th√°i"] || "";
              return `
                <div class="portal-list-item">
                  ${ten} ‚Äì t·ª´ ${tuNgay} ƒë·∫øn ${denNgay}
                  ${stt ? ` ‚Äì Tr·∫°ng th√°i: <strong>${stt}</strong>` : ""}
                </div>
              `;
            })
            .join("");
        }
      }

      // B√°o h·ªèng
      const baoHong = portalData.baoHong || [];
      if (baoHongBox) {
        if (!baoHong.length) {
          baoHongBox.textContent = "Ch∆∞a c√≥ b√°o h·ªèng n√†o.";
        } else {
          baoHongBox.innerHTML = baoHong
            .map((bh) => {
              const tieuDe = bh.tieuDe || bh["Ti√™u ƒë·ªÅ"] || "--";
              const loai = bh.loaiSuCo || bh["Lo·∫°i s·ª± c·ªë"] || "";
              const tt = bh.trangThai || bh["Tr·∫°ng th√°i"] || "";
              const created = bh.createdAt || bh["Ng√†y g·ª≠i"] || "";
              return `
                <div class="portal-list-item">
                  <strong>${tieuDe}</strong>${loai ? ` (${loai})` : ""}<br/>
                  G·ª≠i l√∫c: ${created || "--"}
                  ${tt ? ` ‚Äì Tr·∫°ng th√°i: <strong>${tt}</strong>` : ""}
                </div>
              `;
            })
            .join("");
        }
      }
    }

    async function handleRoomLoginSubmit(event) {
      event.preventDefault();
      const statusEl = document.getElementById("roomLoginStatus");
      const roomId = (document.getElementById("loginRoomId").value || CURRENT_LOGIN_ROOM_ID || "").trim();
      const phone = (document.getElementById("loginPhone").value || "").trim();

      if (!roomId || !phone) {
        if (statusEl) statusEl.textContent = "Vui l√≤ng nh·∫≠p ƒë·ªß M√£ ph√≤ng v√† S·ªë ƒëi·ªán tho·∫°i.";
        return;
      }

      if (statusEl) statusEl.textContent = "ƒêang ki·ªÉm tra h·ª£p ƒë·ªìng...";

      try {
        const body = new URLSearchParams({
          action: "roomLogin",       // üëâ Backend ƒë·ªçc action n√†y
          maPhong: roomId,
          phone: phone
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8"
          },
          body
        });

        const data = await res.json();

        if (!data || !data.success) {
          if (statusEl) {
            statusEl.textContent =
              (data && data.message) ||
              "Kh√¥ng t√¨m th·∫•y H·ª£p ƒë·ªìng c√≤n hi·ªáu l·ª±c v·ªõi m√£ ph√≤ng v√† s·ªë ƒëi·ªán tho·∫°i n√†y.";
          }
          return;
        }

        if (statusEl) statusEl.textContent = "ƒêƒÉng nh·∫≠p th√†nh c√¥ng.";
        closeRoomLoginModal();
        // data.portal ch·ª©a d·ªØ li·ªáu ho√° ƒë∆°n, h·ª£p ƒë·ªìng, t·∫°m tr√∫, b√°o h·ªèng
        openRoomPortalModal(roomId, phone, data.portal || {});
      } catch (e) {
        console.error("roomLogin error:", e);
        if (statusEl) statusEl.textContent = "C√≥ l·ªói khi ki·ªÉm tra h·ª£p ƒë·ªìng. Vui l√≤ng th·ª≠ l·∫°i.";
      }
    }

    
    document.addEventListener("DOMContentLoaded", () => {
      document.getElementById("year").textContent = new Date().getFullYear();
      loadLikesFromStorage();
      loadRatingsFromStorage();
      initFilters();
      initTenantTabs();
      loadRoomsFromServer();
      loadContactInfo();

      // ƒêƒÉng nh·∫≠p t√†i kho·∫£n ph√≤ng
      const loginForm = document.getElementById("tenantLoginForm");
      if (loginForm) {
        loginForm.addEventListener("submit", handleTenantLogin);
      }
      const roomLoginForm = document.getElementById("roomLoginForm");
      if (roomLoginForm) {
        roomLoginForm.addEventListener("submit", handleRoomLoginSubmit);
      }
      const mForm = document.getElementById("maintenanceForm");
      if (mForm) {
        mForm.addEventListener("submit", handleMaintenanceSubmit);
      }

      const tForm = document.getElementById("tempStayForm");
      if (tForm) {
        tForm.addEventListener("submit", handleTempStaySubmit);
      }

      // Kh√¥i ph·ª•c tr·∫°ng th√°i ƒëƒÉng nh·∫≠p
      loadTenantFromStorage();
      updateTenantUI();

      document
        .getElementById("contactForm")
        .addEventListener("submit", handleSubmit);
    });
  </script>
</body>
</html>

