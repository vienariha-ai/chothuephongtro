<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Chi ti·∫øt ph√≤ng ‚Äì YT Home</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2563eb;
      --accent: #22c55e;
      --bg: #0b1120;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.2), transparent 50%),
        radial-gradient(circle at top right, rgba(129, 140, 248, 0.2), transparent 55%),
        radial-gradient(circle at bottom, rgba(45, 212, 191, 0.25), transparent 55%),
        var(--bg);
      color: #e5e7eb;
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }

    .container {
      width: 100%;
      max-width: 1120px;
      margin: 0 auto;
      padding: 16px;
    }

    header {
      border-bottom: 1px solid rgba(148, 163, 184, 0.5);
      margin-bottom: 16px;
      padding-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .logo-icon {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: conic-gradient(from 120deg, #38bdf8, #22c55e, #6366f1, #38bdf8);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #0b1120;
      font-size: 0.9rem;
      font-weight: 800;
    }

    .btn {
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 0.85rem;
      font-weight: 600;
      border: none;
      cursor: pointer;
      background: radial-gradient(circle at top left, #38bdf8, #2563eb);
      color: #f9fafb;
      box-shadow: 0 10px 25px rgba(37, 99, 235, 0.5);
      transition: transform 0.18s ease, box-shadow 0.18s ease, filter 0.18s ease;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 16px 40px rgba(37, 99, 235, 0.8);
      filter: brightness(1.05);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid rgba(148, 163, 184, 0.8);
      box-shadow: none;
    }

    main { padding-bottom: 24px; }

    .breadcrumb {
      font-size: 0.8rem;
      color: rgba(148, 163, 184, 0.9);
      margin-bottom: 12px;
    }

    .breadcrumb a { text-decoration: underline; }

    .layout {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 16px;
    }

    .card {
      background: radial-gradient(circle at top, rgba(15, 23, 42, 0.98), rgba(15, 23, 42, 1));
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      box-shadow: 0 18px 46px rgba(15, 23, 42, 0.96);
      padding: 14px;
      font-size: 0.9rem;
    }

    .room-title-line {
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 4px;
    }

    .room-title { font-size: 1.3rem; font-weight: 700; }
    .room-sub { font-size: 0.85rem; color: rgba(148, 163, 184, 0.95); margin-bottom: 8px; }

    .price-row {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 8px; flex-wrap: wrap;
    }

    .price { font-size: 1.15rem; font-weight: 700; }

    .status-chip {
      font-size: 0.75rem;
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.9);
      background: rgba(15, 23, 42, 0.95);
      white-space: nowrap;
    }

    .status-available { background: #22c55e; border-color: #22c55e; color: #022c22; }
    .status-rented    { background: #4b5563; border-color: #6b7280; color: #e5e7eb; }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 8px;
      margin-bottom: 8px;
      font-size: 0.82rem;
    }

    .meta-item span { display: block; }
    .meta-label { color: rgba(148, 163, 184, 0.95); }
    .meta-value { font-weight: 600; }

    .section-title { font-size: 1rem; font-weight: 600; margin: 10px 0 6px; }
    .room-desc { font-size: 0.9rem; color: rgba(209, 213, 219, 0.98); }

    /* Rating */
    .rating { display:flex; align-items:center; gap:2px; margin-top:4px; font-size:0.9rem; }
    .rating .star { cursor:pointer; color:#fbbf24; opacity:0.35; transition:transform .12s,opacity .12s; }
    .rating .star.active{opacity:1;}
    .rating .star:hover{transform:translateY(-1px) scale(1.05); opacity:1;}

    .asset-list{padding-left:18px;margin-top:4px;font-size:0.85rem;color:rgba(209,213,219,0.98);}
    .asset-list li{margin-bottom:2px;}

    .gallery{display:grid;grid-template-columns:2fr 1fr;gap:8px;margin-top:8px;}
    .gallery-main img,.gallery-thumb img{width:100%;height:100%;object-fit:cover;border-radius:12px;}
    .gallery-thumb-grid{display:grid;grid-template-columns:1fr;gap:6px;height:100%;}
    .gallery-placeholder{
      font-size:0.8rem;color:rgba(148,163,184,0.95);
      padding:18px;border-radius:12px;border:1px dashed rgba(148,163,184,0.8);text-align:center;
    }

    #videoContainer{position:relative;width:100%;padding-top:56.25%;margin-top:8px;border-radius:12px;overflow:hidden;background:#000;}
    #videoContainer iframe,#videoContainer video{position:absolute;inset:0;width:100%;height:100%;border:none;}

    .fee-table{width:100%;border-collapse:collapse;font-size:0.85rem;margin-top:6px;}
    .fee-table th,.fee-table td{border:1px solid rgba(55,65,81,0.9);padding:6px 8px;vertical-align:top;}
    .fee-table th{background:rgba(15,23,42,0.9);}
    .fee-table th:nth-child(1),.fee-table td:nth-child(1){width:38%;}
    .fee-table th:nth-child(2),.fee-table td:nth-child(2){width:27%;white-space:nowrap;text-align:right;}
    .fee-table th:nth-child(3),.fee-table td:nth-child(3){width:35%;}

    .service-icon{margin-right:6px;font-size:1rem;display:inline-block;transition:transform .15s;}
    .fee-table tr:hover .service-icon{transform:scale(1.1);}

    .badge-row{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
    .badge{
      font-size:0.78rem;padding:4px 9px;border-radius:999px;
      border:1px dashed rgba(148,163,184,0.9);background:rgba(15,23,42,0.95);
    }

    /* Form li√™n h·ªá */
    .form-group{margin-bottom:8px;font-size:0.85rem;}
    .form-group label{display:block;margin-bottom:2px;font-weight:600;}
    .form-control{
      width:100%;padding:6px 8px;border-radius:10px;
      border:1px solid rgba(148,163,184,0.8);background:rgba(15,23,42,0.96);
      color:#e5e7eb;font-size:0.85rem;outline:none;
    }
    .form-control:focus{border-color:#38bdf8;}
    textarea.form-control{min-height:80px;resize:vertical;}
    #formStatus{font-size:0.8rem;margin-top:4px;color:rgba(148,163,184,0.96);}

    .quick-links{margin-top:8px;font-size:0.8rem;color:rgba(148,163,184,0.96);}
    .quick-links-row{display:flex;flex-wrap:wrap;gap:8px;margin-top:4px;}

    @media (max-width: 900px) {
      .layout { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon">YT</div>
        <div>
          <div>YT Home</div>
          <div style="font-size:0.7rem; font-weight:500; color:rgba(148,163,184,0.9);">
            Chi ti·∫øt ph√≤ng
          </div>
        </div>
      </div>
      <button class="btn btn-outline" onclick="window.location.href='index.html'">
        ‚Üê Quay v·ªÅ danh s√°ch
      </button>
    </header>

    <main>
      <div class="breadcrumb">
        <a href="index.html">Danh s√°ch ph√≤ng</a> ‚Ä∫
        <span id="breadcrumbRoom">ƒêang t·∫£i...</span>
      </div>

      <div id="loadingText"
           style="font-size:0.9rem; color:rgba(148,163,184,0.96); margin-bottom:10px;">
        ƒêang t·∫£i th√¥ng tin ph√≤ng...
      </div>

      <div id="detailLayout" class="layout" style="display:none;">
        <!-- C·ªôt tr√°i -->
        <div>
          <div class="card" id="roomInfoCard"></div>

          <div class="card" style="margin-top:12px;">
            <div class="section-title">H√¨nh ·∫£nh & video ph√≤ng</div>
            <div id="galleryContainer"></div>
            <div id="videoContainer"></div>
          </div>
        </div>

        <!-- C·ªôt ph·∫£i -->
        <div>
          <!-- Chi ph√≠ d·ªãch v·ª• -->
          <div class="card" id="feeCard">
            <div class="section-title">Chi ph√≠ d·ªãch v·ª• tham kh·∫£o</div>
            <p style="font-size:0.85rem;">ƒêang t·∫£i th√¥ng tin d·ªãch v·ª•...</p>
          </div>

          <!-- L∆∞u √Ω & ch√≠nh s√°ch -->
          <div class="card" style="margin-top:12px;">
            <div class="section-title">L∆∞u √Ω & ch√≠nh s√°ch</div>
            <ul style="font-size:0.85rem; padding-left:18px; margin-top:4px;">
              <li>H·ª£p ƒë·ªìng t·ªëi thi·ªÉu <strong>6‚Äì12 th√°ng</strong> (c√≥ th·ªÉ linh ho·∫°t theo t·ª´ng ph√≤ng).</li>
              <li>C·ªçc t·ªëi thi·ªÉu <strong>1‚Äì2 th√°ng ti·ªÅn nh√†</strong> t√πy th·ªùi h·∫°n thu√™.</li>
              <li>Gi·ªõi h·∫°n s·ªë ng∆∞·ªùi ·ªü ƒë·ªÉ ƒë·∫£m b·∫£o kh√¥ng gian s·ªëng vƒÉn minh, y√™n tƒ©nh.</li>
              <li>H·ªó tr·ª£ ƒëƒÉng k√Ω t·∫°m tr√∫ & khai b√°o c∆∞ tr√∫ theo quy ƒë·ªãnh.</li>
            </ul>
          </div>

          <!-- ƒê·∫∑t l·ªãch xem ph√≤ng -->
          <div class="card" style="margin-top:12px;">
            <div class="section-title">ƒê·∫∑t l·ªãch xem ph√≤ng n√†y</div>
            <p style="font-size:0.85rem; margin-bottom:6px;">
              ƒêi·ªÅn th√¥ng tin b√™n d∆∞·ªõi, YT Home s·∫Ω li√™n h·ªá ƒë·ªÉ x√°c nh·∫≠n l·ªãch xem ph√≤ng
              <strong id="roomIdShort"></strong>.
            </p>
            <form id="contactForm">
              <div class="form-group">
                <label for="name">H·ªç v√† t√™n</label>
                <input id="name" class="form-control" type="text" required />
              </div>
              <div class="form-group">
                <label for="phone">S·ªë ƒëi·ªán tho·∫°i/Zalo</label>
                <input id="phone" class="form-control" type="tel" required />
              </div>
              <div class="form-group">
                <label for="message">N·ªôi dung</label>
                <textarea id="message" class="form-control"></textarea>
              </div>
              <button type="submit" class="btn" style="width:100%;">G·ª≠i y√™u c·∫ßu xem ph√≤ng</button>
              <p id="formStatus"></p>
            </form>

            <div class="quick-links">
              Ho·∫∑c li√™n h·ªá nhanh:
              <div class="quick-links-row">
                <a id="zaloQuickLink" class="btn btn-outline" href="#"
                   target="_blank" rel="noopener noreferrer"
                   style="padding:6px 14px; font-size:0.78rem;">
                  Nh·∫Øn Zalo
                </a>
                <a id="emailQuickLink" class="btn btn-outline" href="#"
                   style="padding:6px 14px; font-size:0.78rem;">
                  G·ª≠i Email
                </a>
                <a id="messengerQuickLink" class="btn btn-outline" href="#"
                   target="_blank" rel="noopener noreferrer"
                   style="padding:6px 14px; font-size:0.78rem;">
                  Chat Messenger
                </a>
              </div>

              <p style="margin-top:8px; font-size:0.78rem;">
                C∆∞ d√¢n ƒë√£ thu√™ ph√≤ng c√≥ th·ªÉ truy c·∫≠p
                <a id="tenantPortalLink"
                   href="tenant.html"
                   style="text-decoration:underline; color:#bfdbfe;">
                  T√†i kho·∫£n ph√≤ng (H√≥a ƒë∆°n & y√™u c·∫ßu)
                </a>.
              </p>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    const API_URL =
      "https://script.google.com/macros/s/AKfycbwyqskjnUjwkn95TqRmcFjLem2eSMfKBuh23PHDD0QcL0gCwEnqNLYxd6vmi7xqDzUoow/exec";

    let CONTACT_INFO = { zalo: "", email: "", messenger: "" };
    let CURRENT_ROOM = null;
    let SERVICES = [];

    const RATING_STORAGE_KEY = "ytHomeRoomRatings";
    let ROOM_RATINGS = {};

    function loadRatingsFromStorage() {
      try {
        const raw = localStorage.getItem(RATING_STORAGE_KEY);
        ROOM_RATINGS = raw ? JSON.parse(raw) : {};
      } catch (e) { ROOM_RATINGS = {}; }
    }

    function saveRatingsToStorage() {
      try {
        localStorage.setItem(RATING_STORAGE_KEY, JSON.stringify(ROOM_RATINGS));
      } catch (e) { console.error(e); }
    }

    function getRoomRating(roomId) {
      if (!roomId) return 0;
      const data = ROOM_RATINGS[roomId] || { rating: 0 };
      return data.rating || 0;
    }

    function setRoomRating(roomId, rating) {
      if (!roomId) return;
      const r = Math.max(1, Math.min(5, rating));
      ROOM_RATINGS[roomId] = { rating: r };
      saveRatingsToStorage();
      renderRoomRating(roomId);
    }

    function buildStarsHtml(roomId) {
      const current = getRoomRating(roomId);
      let html = `<div class="rating" data-room="${roomId}">`;
      for (let i = 1; i <= 5; i++) {
        const active = i <= current ? "active" : "";
        html += `<span class="star ${active}" onclick="setRoomRating('${roomId}', ${i})">‚òÖ</span>`;
      }
      html += `<span style="margin-left:6px; font-size:0.8rem;">ƒê√°nh gi√° c·ªßa b·∫°n</span></div>`;
      return html;
    }

    function renderRoomRating(roomId) {
      const box = document.getElementById("roomRatingContainer");
      if (!box) return;
      box.innerHTML = buildStarsHtml(roomId);
    }

    function formatVND(amount) {
      if (amount === null || amount === undefined || amount === "") return "--";
      const num = Number(String(amount).replace(/[^\d.-]/g, ""));
      if (isNaN(num)) return String(amount);
      return num.toLocaleString("vi-VN") + " ƒë";
    }

    function getQueryParam(name) {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function buildVideoEmbed(url) {
      if (!url) return "";
      const u = String(url).trim();
      if (u.includes("youtube.com") || u.includes("youtu.be")) {
        let videoId = "";
        const shortMatch = u.match(/youtu\.be\/([^?&]+)/);
        if (shortMatch) videoId = shortMatch[1];
        const longMatch = u.match(/[?&]v=([^&]+)/);
        if (longMatch) videoId = longMatch[1] || videoId;
        if (!videoId) return `<iframe src="${u}" allowfullscreen></iframe>`;
        const embedUrl = "https://www.youtube.com/embed/" + videoId;
        return `<iframe src="${embedUrl}" allowfullscreen></iframe>`;
      }
      return `
        <video controls playsinline>
          <source src="${u}">
          Tr√¨nh duy·ªát kh√¥ng h·ªó tr·ª£ ph√°t video.
        </video>`;
    }

    function collectImages(room) {
      const keys = ["anh1","anh2","anh3","hinhAnh1","hinhAnh2","hinhAnh3","image1","image2","image3"];
      const imgs = [];
      keys.forEach(k => { if (room[k]) imgs.push(room[k]); });
      return imgs;
    }

    function getPetAllowFlag(room) {
      if (typeof room.thuCungAllowed === "boolean") return room.thuCungAllowed;
      const raw = String(room.thuCung || room.pet || room.allowPet || "").trim().toLowerCase();
      if (!raw) return null;
      const yes = ["c√≥","yes","y","1","true","cho ph√©p","ƒë∆∞·ª£c"];
      const no  = ["kh√¥ng","ko","no","0","false","k cho","kh√¥ng cho ph√©p"];
      if (yes.some(k => raw.includes(k))) return true;
      if (no.some(k => raw.includes(k))) return false;
      return null;
    }

    function renderRoomDetail(room) {
      const loadingText = document.getElementById("loadingText");
      const layout = document.getElementById("detailLayout");
      const breadcrumbRoom = document.getElementById("breadcrumbRoom");
      const roomInfoCard = document.getElementById("roomInfoCard");
      const galleryContainer = document.getElementById("galleryContainer");
      const videoContainer = document.getElementById("videoContainer");
      const roomIdShort = document.getElementById("roomIdShort");
      const tenantLink = document.getElementById("tenantPortalLink");

      loadingText.style.display = "none";
      layout.style.display = "grid";

      const maPhong   = room.maPhong || "Ph√≤ng";
      const loaiPhong = room.loaiPhong || "Ph√≤ng cho thu√™";
      const gia       = room.giaThue ? formatVND(room.giaThue) + "/th√°ng" : "Gi√° li√™n h·ªá";
      const tang      = room.tang || "‚Äì";
      const coc       = room.coc ? formatVND(room.coc) : "‚Äì";
      const dienTich  = room.dienTich || room.dientich || "ƒêang c·∫≠p nh·∫≠t";
      const note      = room.thongTinPhong || room.ghiChu || "";

      const statusClass =
        room.trangThaiWebsite === "available" ? "status-available" : "status-rented";
      const statusText =
        room.trangThaiWebsite === "available" ? "C√≤n tr·ªëng" : "ƒêang thu√™";

      const assets = Array.isArray(room.assets) ? room.assets : [];
      const allowFlag = getPetAllowFlag(room);
      let petPolicyHTML = "";
      if (allowFlag === true) {
        petPolicyHTML = `
          <div class="section-title">Ch√≠nh s√°ch th√∫ c∆∞ng</div>
          <ul class="asset-list"><li>‚úÖ Cho ph√©p nu√¥i th√∫ c∆∞ng</li></ul>`;
      } else if (allowFlag === false) {
        petPolicyHTML = `
          <div class="section-title">Ch√≠nh s√°ch th√∫ c∆∞ng</div>
          <ul class="asset-list"><li>‚ùå Kh√¥ng cho ph√©p nu√¥i th√∫ c∆∞ng</li></ul>`;
      } else {
        petPolicyHTML = `
          <div class="section-title">Ch√≠nh s√°ch th√∫ c∆∞ng</div>
          <div class="room-desc" style="font-size:0.85rem;">
            Vui l√≤ng li√™n h·ªá ƒë·ªÉ ƒë∆∞·ª£c t∆∞ v·∫•n chi ti·∫øt v·ªÅ ch√≠nh s√°ch th√∫ c∆∞ng cho ph√≤ng n√†y.
          </div>`;
      }

      breadcrumbRoom.textContent = maPhong;
      roomIdShort.textContent = maPhong;
      document.title = maPhong + " ‚Äì YT Home";

      if (tenantLink) {
        tenantLink.href = "tenant.html?room=" + encodeURIComponent(maPhong);
      }

      roomInfoCard.innerHTML = `
        <div class="room-title-line">
          <div class="room-title">${maPhong}</div>
          <div id="roomRatingContainer"></div>
        </div>
        <div class="room-sub">${loaiPhong}</div>
        <div class="price-row">
          <div class="price">${gia}</div>
          <span class="status-chip ${statusClass}">${statusText}</span>
        </div>

        <div class="meta-grid">
          <div class="meta-item">
            <span class="meta-label">T·∫ßng</span>
            <span class="meta-value">${tang}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Di·ªán t√≠ch</span>
            <span class="meta-value">${dienTich}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Ti·ªÅn c·ªçc</span>
            <span class="meta-value">${coc}</span>
          </div>
        </div>

        <div class="section-title">M√¥ t·∫£ ph√≤ng</div>
        <div class="room-desc">
          ${note || "Ch·ªß nh√† ƒëang c·∫≠p nh·∫≠t m√¥ t·∫£ chi ti·∫øt cho ph√≤ng n√†y."}
        </div>

        <div class="section-title">N·ªôi th·∫•t & ti·ªán nghi trong ph√≤ng</div>
        ${
          assets.length
            ? `<ul class="asset-list">
                ${assets.map(a => `<li>‚úÖ ${a.tenTaiSan || a.ten || ""}</li>`).join("")}
               </ul>`
            : `<div class="room-desc" style="font-size:0.85rem;">
                Ch·ªß nh√† ƒëang c·∫≠p nh·∫≠t danh s√°ch n·ªôi th·∫•t chi ti·∫øt. B·∫°n c√≥ th·ªÉ li√™n h·ªá ƒë·ªÉ h·ªèi th√™m.
               </div>`
        }

        ${petPolicyHTML}
      `;

      renderRoomRating(maPhong);

      const images = collectImages(room);
      if (images.length) {
        if (images.length === 1) {
          galleryContainer.innerHTML = `
            <div class="gallery">
              <div class="gallery-main">
                <img src="${images[0]}" alt="H√¨nh ph√≤ng ${maPhong}">
              </div>
              <div class="gallery-thumb-grid"></div>
            </div>`;
        } else {
          const main = images[0];
          const thumbs = images.slice(1, 3);
          galleryContainer.innerHTML = `
            <div class="gallery">
              <div class="gallery-main">
                <img src="${main}" alt="H√¨nh ph√≤ng ${maPhong}">
              </div>
              <div class="gallery-thumb-grid">
                ${thumbs.map(src => `
                  <div class="gallery-thumb">
                    <img src="${src}" alt="H√¨nh ph√≤ng ${maPhong}">
                  </div>`).join("")}
              </div>
            </div>`;
        }
      } else {
        galleryContainer.innerHTML = `
          <div class="gallery-placeholder">
            H√¨nh ·∫£nh chi ti·∫øt c·ªßa ph√≤ng s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t s·ªõm. B·∫°n c√≥ th·ªÉ xem video ho·∫∑c ƒë·∫∑t l·ªãch xem tr·ª±c ti·∫øp.
          </div>`;
      }

      if (room.video) {
        videoContainer.innerHTML = buildVideoEmbed(room.video);
      } else {
        videoContainer.innerHTML = "";
      }

      const msgInput = document.getElementById("message");
      msgInput.value = `Em quan t√¢m ph√≤ng ${maPhong} (${loaiPhong}), xin t∆∞ v·∫•n th√™m v√† ƒë·∫∑t l·ªãch xem ph√≤ng.`;
      CURRENT_ROOM = room;
    }

    function renderFeeCard() {
      const feeCard = document.getElementById("feeCard");
      if (!feeCard) return;

      if (!SERVICES.length) {
        feeCard.innerHTML = `
          <div class="section-title">Chi ph√≠ d·ªãch v·ª• tham kh·∫£o</div>
          <p style="font-size:0.85rem;">
            ƒêang c·∫≠p nh·∫≠t danh s√°ch d·ªãch v·ª•. Vui l√≤ng li√™n h·ªá ƒë·ªÉ bi·∫øt chi ti·∫øt.
          </p>`;
        return;
      }

      const rowsHtml = SERVICES.map((s) => {
        const ten = s.nhomDichVu || s.maDV || "D·ªãch v·ª•";
        const giaText = s.donGia ? formatVND(s.donGia) : "--";
        let ghiChu = s.thongTinDichVu || "";
        if (s.loai) ghiChu = ghiChu ? ghiChu + " ‚Äì " + s.loai : s.loai;

        let icon = "üíº";
        const keyword = ten.toLowerCase();
        if (keyword.includes("n∆∞·ªõc")) icon = "üíß";
        else if (keyword.includes("ƒëi·ªán")) icon = "‚ö°";
        else if (keyword.includes("wifi") || keyword.includes("internet")) icon = "üì∂";
        else if (keyword.includes("xe")) icon = "üõµ";
        else if (keyword.includes("r√°c") || keyword.includes("v·ªá sinh")) icon = "üóëÔ∏è";
        else if (keyword.includes("gi·∫∑t")) icon = "üß∫";
        else if (keyword.includes("d·ªãch v·ª•")) icon = "üîß";
        else if (keyword.includes("c·ªçc")) icon = "üí∞";

        return `
          <tr>
            <td><span class="service-icon">${icon}</span>${ten}</td>
            <td>${giaText}</td>
            <td>${ghiChu}</td>
          </tr>`;
      }).join("");

      feeCard.innerHTML = `
        <div class="section-title">Chi ph√≠ d·ªãch v·ª• tham kh·∫£o</div>
        <table class="fee-table">
          <tr>
            <th>D·ªãch v·ª•</th>
            <th style="text-align:right;">Gi√°</th>
            <th>Ghi ch√∫</th>
          </tr>
          ${rowsHtml}
        </table>
        <div class="badge-row">
          <div class="badge">H·ª£p ƒë·ªìng r√µ r√†ng</div>
          <div class="badge">Kh√¥ng ph√≠ m√¥i gi·ªõi</div>
          <div class="badge">∆Øu ti√™n ·ªü l√¢u d√†i</div>
        </div>`;
    }

    async function loadRoomDetailFromServer() {
      const roomId = getQueryParam("room");
      const loadingText = document.getElementById("loadingText");

      if (!roomId) {
        loadingText.textContent = "Kh√¥ng t√¨m th·∫•y m√£ ph√≤ng tr√™n ƒë∆∞·ªùng d·∫´n.";
        return;
      }

      loadingText.textContent = "ƒêang t·∫£i th√¥ng tin ph√≤ng " + roomId + "...";

      try {
        const res = await fetch(
          API_URL + "?action=roomDetail&room=" + encodeURIComponent(roomId)
        );
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        const room = data && data.room;
        if (!room) {
          loadingText.textContent =
            "Kh√¥ng t√¨m th·∫•y th√¥ng tin ph√≤ng " + roomId + " trong h·ªá th·ªëng.";
          return;
        }
        renderRoomDetail(room);
        if (SERVICES.length) renderFeeCard();
      } catch (err) {
        console.error(err);
        loadingText.textContent =
          "C√≥ l·ªói khi t·∫£i th√¥ng tin ph√≤ng. Vui l√≤ng th·ª≠ l·∫°i sau.";
      }
    }

    async function loadServicesFromServer() {
      try {
        const res = await fetch(API_URL + "?action=services");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        SERVICES = (data && data.services) || [];
        if (CURRENT_ROOM) renderFeeCard();
      } catch (err) {
        console.error("loadServicesFromServer error:", err);
        renderFeeCard();
      }
    }

    async function loadContactInfo() {
      try {
        const res = await fetch(API_URL + "?action=contactInfo");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        CONTACT_INFO = (data && data.contact) || CONTACT_INFO;

        const zaloLink = document.getElementById("zaloQuickLink");
        const mailLink = document.getElementById("emailQuickLink");
        const msgLink  = document.getElementById("messengerQuickLink");

        if (zaloLink && CONTACT_INFO.zalo) zaloLink.href = CONTACT_INFO.zalo;
        if (mailLink && CONTACT_INFO.email) {
          const subject = encodeURIComponent("ƒê·∫∑t l·ªãch xem ph√≤ng t·∫°i YT Home");
          mailLink.href = `mailto:${CONTACT_INFO.email}?subject=${subject}`;
        }
        if (msgLink && CONTACT_INFO.messenger) msgLink.href = CONTACT_INFO.messenger;
      } catch (err) { console.error("loadContactInfo error:", err); }
    }

    async function handleSubmit(event) {
      event.preventDefault();
      const formStatus = document.getElementById("formStatus");
      formStatus.textContent = "ƒêang g·ª≠i...";

      const roomId = getQueryParam("room") || "";
      const name   = document.getElementById("name").value.trim();
      const phone  = document.getElementById("phone").value.trim();
      const message= document.getElementById("message").value.trim();

      try {
        const body = new URLSearchParams({
          action: "contact",
          name,
          phone,
          roomType: roomId ? "Quan t√¢m ph√≤ng " + roomId : "",
          message
        });

        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded;charset=UTF-8" },
          body
        });

        const data = await res.json();
        formStatus.textContent =
          (data && data.message) || "G·ª≠i th√†nh c√¥ng. C·∫£m ∆°n b·∫°n ƒë√£ li√™n h·ªá YT Home.";
        document.getElementById("contactForm").reset();
      } catch (err) {
        console.error(err);
        formStatus.textContent =
          "C√≥ l·ªói khi g·ª≠i th√¥ng tin. Vui l√≤ng th·ª≠ l·∫°i sau.";
      }
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadRatingsFromStorage();
      loadRoomDetailFromServer();
      loadServicesFromServer();
      loadContactInfo();

      const contactForm = document.getElementById("contactForm");
      if (contactForm) contactForm.addEventListener("submit", handleSubmit);
    });
  </script>
</body>
</html>
